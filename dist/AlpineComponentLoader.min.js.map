{"version":3,"sources":["../src/index.js"],"names":["styleSheetCache","Map","scriptLoadCache","typeMap","String","Number","Boolean","Array","Object","dataFetchCache","toUrlValue","v","encodeURIComponent","JSON","stringify","AlpineComponentLoader","start","_started","pruneCaches","registerComponent","registerDynamicLoader","registerTemplates","prefix","current","globalConfig","_templateCachePrefix","_templateCacheKey","window","Promise","all","caches","keys","filter","key","startsWith","map","delete","clearCache","console","warn","config","options","assign","name","defaultComponentName","customElements","get","define","AlpineDeclarativeLoader","defaultDynamicName","AlpineDynamicLoader","document","querySelectorAll","forEach","tpl","tagName","getAttribute","attributes","fromEntries","entries","parse","val","type","e","toggleDebug","prefetch","_registry","loadTemplate","source","settings","el","useCache","faH","_cache","match","fetchedAt","res","clone","headers","HTMLTemplateElement","content","querySelector","reject","Error","cacheTemplates","open","ok","isNaN","Date","now","_templateCacheExpire","text","fetch","cache","status","Headers","set","toString","put","Response","body","statusText","ReadableStream","pipeThrough","TextDecoderStream","loading","hooks","beforeFetch","opts","afterFetch","data","externalCss","externalScripts","sharedStyleSheets","errorCss","display","flexDirection","gap","padding","border","backgroundColor","color","borderRadius","fontFamily","fontSize","forwardEvents","fallback","persist","persistKey","persistDebounce","bindStore","dataSrc","dataFetchParams","dataFetchKeys","dataFetchPoll","dataFetchTimeout","dataFetchOptions","observedAttrs","Set","contentSource","basePath","AlpineExternalComponent","_$props","$data","$loading","$error","$lastUpdated","$emit","detail","_this","dispatchEvent","CustomEvent","bubbles","composed","$reload","reload","_initialized","_loading","_disconnectTimeout","_fetchAbortController","$props","Alpine","reactive","_root","shadow","attachShadow","mode","_observer","_scopeId","Math","random","slice","_slotObserver","_originalLightDom","createDocumentFragment","_pollTimer","attributeChangedCallback","oldVal","newVal","includes","_fetchData","_startPolling","_updateProp","_triggerHook","connectedCallback","setAttribute","clearTimeout","_syncAllAttributes","loadMode","_initLazyObserver","_initIdleLoader","_load","disconnectedCallback","_stopPolling","disconnect","_isKeptAlive","hasAttribute","setTimeout","isConnected","abort","destroyTree","interval","parseInt","src","placeholder","createElement","style","minHeight","appendChild","IntersectionObserver","isIntersecting","rootMargin","observe","requestIdleCallback","timeout","_initSlotObserver","MutationObserver","mutations","mutation","addedNodes","node","nodeType","Node","ELEMENT_NODE","TEXT_NODE","slotName","container","childList","currentDataSrc","log","startMark","lightSlots","err","fallbackSource","fallbackErr","performance","length","_loadExternalDependencies","resolve","_resolveContent","_captureLightSlots","replaceChildren","url","link","rel","href","_renderSafe","_setupEventForwarding","_initAlpine","_perf","duration","_dispatch","error","_renderError","message","skipCache","signal","timeoutId","resolveValue","params","resolvedUrl","finalUrl","fetchTask","json","processedData","modified","AbortController","attrName","configVal","result","attrVal","context","trimmed","evaled","$el","props","root","$root","trim","replace","Function","call","k","URL","location","origin","search","toSearchParamsDeep","obj","_params","URLSearchParams","add","value","isArray","append","has","contentType","method","catch","race","_","addEventListener","once","aborted","reason","fetchTimeout","hookName","promises","head","p","script","async","onload","onerror","push","firstChild","from","childNodes","reduce","slots","concat","default","rootNode","reader","decoder","accumulator","done","doc","styles","combinedCss","sheet","scripts","getReader","TextDecoder","read","decode","stream","join","DOMParser","parseFromString","cloneNode","stripStyles","remove","useConstructibleStyles","adoptedStyleSheets","s","textContent","CSSStyleSheet","replaceSync","scopeSelector","executeScripts","oldScript","newScript","attr","slotEl","anchor","nodesToInsert","replaceWith","eventName","parsedValue","configDef","required","validator","defaultValue","hasOwnProperty","undefined","schema","_applyTypeDefault","num","some","t","_initPersistence","storage","localStorage","sessionStorage","localName","id","debounceMs","_timer","getSnapshot","saveNow","setItem","$persistence","$key","$save","$clear","removeItem","$get","stored","getItem","$flush","prototype","effect","_finishAlpineInit","storeName","store","children","nextTick","initTree","msg","cssText","m","toLowerCase","header","code","marginTop","_pruneCache","pruneCache","_clearCache","observedAttributes","HTMLElement","_debugger","debug","_templateCacheVersion","inferredType","realElement","split","pop","shift","_switch","firstElementChild","clear","tag","updateDOM","keepAlive","_savedScroll","scrollTop","startViewTransition","transition","opacity","r","requestAnimationFrame","readyState"],"mappings":"uiLAAA;;;;;;;CAOC,EAGD,IAAMA,EAAkB,IAAIC,IAGtBC,EAAkB,IAAID,IAGtBE,EAAU,CACZ,OAAUC,OACV,OAAUC,OACV,QAAWC,QACX,MAASC,MACT,OAAUC,MACd,EAGMC,EAAiB,IAAIR,IAUrBS,EAAa,SAACC,UAAMC,mBAAmB,AAAC,CAAA,SAAOD,cAAP,EAAOA,EAAAA,IAAM,UAAYA,AAAM,OAANA,EAAcE,KAAKC,SAAS,CAACH,GAAKA,IAgC1F,AAAMI,eAAN,oBAAMA,WAAAA,YAAAA,SAoCJC,IAAAA,cAAb,gFACI,GArCaD,AAqCTA,EAAsBE,QAAQ,CAC9B,UAIJ,OA1CaF,AAuCbA,EAAsBE,QAAQ,CAAG,CAAA,KAvCpBF,AA0CPA,EAAsBG,WAAW,kBAAvC,SA1CaH,AA6CbA,EAAsBI,iBAAiB,GA7C1BJ,AA8CbA,EAAsBK,qBAAqB,GA9C9BL,AA+CbA,EAAsBM,iBAAiB,SAC3C,QAGaH,IAAAA,oBAAb,mCAAyBI,EAAkEC,iEACvF,GADqBD,EAAAA,+BAnDRP,AAmDiBA,EAAsBS,YAAY,CAACC,oBAAoB,CAAEF,EAAAA,+BAnD1ER,AAmDoFA,EAAsBS,YAAY,CAACE,iBAAiB,CACjJ,CAAE,CAAA,WAAYC,MAAK,EACnB,UACsB,SAAbC,QAAQC,GAAG,IAAQC,OAAOC,IAAI,WAApC,SAAMH,QAAAA,SAAY,AAAC,SACrBI,MAAM,CAACC,SAAAA,UAAOA,EAAIC,UAAU,CAACZ,KAC7BU,MAAM,CAACC,SAAAA,UAAOA,IAAQV,IACtBY,GAAG,CAACF,SAAAA,UAAOH,OAAOM,MAAM,CAACH,eAH9B,SAAO,YAIX,4BAGaI,IAAAA,mBAAb,mCAAwBd,iEACpB,GADoBA,EAAAA,+BA7DPR,AA6DiBA,EAAsBS,YAAY,CAACE,iBAAiB,CAC9E,CAAE,CAAA,WAAYC,MAAK,EAEnB,OADAW,QAAQC,IAAI,CAAC,sCAKS,SAAbX,QAAQC,GAAG,IAAQC,OAAOC,IAAI,WAApC,SAAMH,QAAAA,SAAY,AAAC,SACrBI,MAAM,CAACC,SAAAA,UAAOA,EAAIC,UAAU,CAACX,KAC7BY,GAAG,CAACF,SAAAA,UAAOH,OAAOM,MAAM,CAACH,eAF9B,SAAO,YAGX,4BAGOO,IAAAA,eAAP,SAAcC,CAAO,EACjBjC,OAAOkC,MAAM,CA3EA3B,AA2ECA,EAAsBS,YAAY,CAAEiB,EACtD,IAGOtB,IAAAA,0BAAP,eAAyBwB,EAAAA,uDA/ER5B,AA+EeA,EAAsBS,YAAY,CAACoB,oBAAoB,AAC/E,CAACC,eAAeC,GAAG,CAACH,IACpBE,eAAeE,MAAM,CAACJ,EAAMK,EACpC,IAGO5B,IAAAA,8BAAP,eAA6BuB,EAAAA,uDArFZ5B,AAqFmBA,EAAsBS,YAAY,CAACyB,kBAAkB,AACjF,CAACJ,eAAeC,GAAG,CAACH,IACpBE,eAAeE,MAAM,CAACJ,EAAMO,EACpC,IAGO7B,IAAAA,0BAAP,WACI8B,SAASC,gBAAgB,CAAC,2BAA2BC,OAAO,CAACC,SAAAA,GACzD,IAKId,EALEe,EAAUD,EAAIE,YAAY,CAAC,iBACjC,GAAKD,GAKL,GAAI,CACAf,EAAS,CACLiB,WAAYjD,OAAOkD,WAAW,CAAClD,OAAOmD,OAAO,CAAC9C,KAAK+C,KAAK,CAACN,EAAIE,YAAY,CAAC,cAAgB,OAAOrB,GAAG,CAAC,yBAAEF,OAAK4B,aAAS,CACjH5B,EACA,AAAC,CAAA,SAAO4B,cAAP,EAAOA,EAAE,IAAM,UAAYA,EAAIC,IAAI,CAAI,OACjCD,IACHC,KAAM3D,CAAO,CAAC0D,EAAIC,IAAI,CAAC,EAAI1D,SAC1BD,CAAO,CAAC0D,EAAI,EAAIzD,OACxB,GACL,CACJ,CAAE,MAAO2D,EAAG,CACRzB,QAAQC,IAAI,CAAC,AAAC,wCAA+C,OAARgB,EAAQ,KAAIQ,EACrE,CA/GShD,AAkHTA,EAAsBgC,MAAM,CAACQ,EAASD,EAAKd,GAAU,CAAC,GAC1D,EACJ,IAGOwB,IAAAA,oBAAP,WACI1B,QAAQC,IAAI,CAAC,iEACjB,IAGa0B,IAAAA,iBAAb,SAAsBV,CAAO,0BACnBf,mDACN,GAAI,CADEA,CAAAA,EA7HOzB,AA6HEA,EAAsBmD,SAAS,CAACpB,GAAG,CAACS,EAAO,EAGtD,OADAjB,QAAQC,IAAI,CAAC,AAAC,0BAAiC,OAARgB,EAAQ,kCAG5C,SAlIMxC,AAkIAA,EAAsBoD,YAAY,CAAC3B,EAAO4B,MAAM,CAAE5B,EAAO6B,QAAQ,UAA9E,SAAO,YACX,QAGaF,IAAAA,qBAAb,SAA0BC,CAAM,CAAEC,CAAQ,0BAK5BC,EASJC,EACFC,EAGAC,EAOUC,EAEIC,EASZC,EAQQC,EACFC,mDA3CZ,GAAIV,AAAM,EAANA,EAAkBW,qBAClB,SAAOX,EAAOY,OAAO,EAClB,GAAI,AAAkB,UAAlB,OAAOZ,GAAuBA,EAAOlC,UAAU,CAAC,KAAM,CAE7D,GAAI,CADEoC,CAAAA,EAAKnB,SAAS8B,aAAa,CAACb,EAAM,EAEpC,SAAOxC,QAAQsD,MAAM,CAAC,AAAIC,MAAM,AAAC,gBAAsB,OAAPf,EAAO,kBAC3D,GAAI,CAAEE,AAAE,EAAFA,EAAcS,qBAChB,SAAOnD,QAAQsD,MAAM,CAAC,AAAIC,MAAM,AAAC,OAAa,OAAPf,EAAO,4BAClD,SAAOE,EAAGU,OAAO,CACrB,IAGMT,EAAWF,EAASe,cAAc,EAAI,WAAYzD,OACpD6C,EAAM,qBAIND,EAAAA,6BAGa,gCAAMzC,OAAOuD,IAAI,CAAChB,EAAS3C,iBAAiB,UAGvC,SAHd+C,AAGoBA,CAHpBA,EAAS,QAA4C,EAG1BC,KAAK,CAACN,sBAA3BM,CAAAA,EAAQ,QAAyB,SACnCA,EAAOY,EAAE,cAET,GAAI,CAACjF,OAAOkF,KAAK,CADXZ,EAAYtE,OAAOqE,EAAMI,OAAO,CAAChC,GAAG,CAAC0B,MACX,AAACgB,KAAKC,GAAG,GAAKd,EAAaN,EAASqB,oBAAoB,CACpF,SAAOhB,EAAMiB,IAAI,IACrB,SAAMlB,EAAOrC,MAAM,CAACiC,EAAS3C,iBAAiB,UAA9C,0EAMA,SAAMkE,MAAMxB,EAAQ,CAAEyB,MAAO,UAAW,WACpD,GAAI,CADEjB,AACDA,CADCA,EAAM,QAAyC,EAC5CU,EAAE,CACP,MAAM,AAAIH,MAAM,AAAC,QAAkB,OAAXP,EAAIkB,MAAM,OAGlCvB,EAAAA,8BAUI,+BAHAO,CAHIA,EAAU,IAAIiB,QADZlB,AACoBA,CADpBA,EAAQD,EAAIC,KAAK,EAAC,EACQC,OAAO,GAG/BkB,GAAG,CAACxB,EAAKgB,KAAKC,GAAG,GAAGQ,QAAQ,OAG9BxB,EAAOyB,GAAG,CACZ9B,EACA,IAAI+B,SAAStB,EAAMuB,IAAI,CAAE,CACrBN,OAAQjB,EAAMiB,MAAM,CACpBO,WAAYxB,EAAMwB,UAAU,CAC5BvB,QAAAA,CACJ,4BANJ,wBAWJ,GAAIF,EAAIwB,IAAI,EAAI,AAA0B,IAA1B,OAAOE,eACnB,SAAO1B,EAAIwB,IAAI,CAACG,WAAW,CAAC,IAAIC,uCAIxC,SAAO5B,EAAIe,IAAI,MACnB,QAGO5C,IAAAA,eAAP,SAAcQ,CAAO,CAAEa,CAAM,MAAE5B,EAAAA,uDAAS,CAAC,EAE/B6B,EAAW,KACbZ,WAAY,CAAC,EACbgD,QAAS,QACTC,MAAO,CACHC,YAAa,SAACC,UAASA,GACvBC,WAAY,SAACC,UAASA,EAC1B,GArNS/F,AAsNNA,EAAsBS,YAAY,CAClCgB,IACHuE,YAAa,AACT,EAzNKhG,AAyNDA,EAAsBS,YAAY,CAACuF,WAAW,EAAI,EAAE,SACxD,EAAIvE,EAAOuE,WAAW,EAAI,EAAE,GAEhCC,gBAAiB,AACb,EA7NKjG,AA6NDA,EAAsBS,YAAY,CAACwF,eAAe,EAAI,EAAE,SAC5D,EAAIxE,EAAOwE,eAAe,EAAI,EAAE,GAEpCC,kBAAmB,AACf,EAjOKlG,AAiODA,EAAsBS,YAAY,CAACyF,iBAAiB,EAAI,EAAE,SAC9D,EAAIzE,EAAOyE,iBAAiB,EAAI,EAAE,GAEtCC,SAAU,KACH,CACCC,QAAS,OACTC,cAAe,SACfC,IAAK,SACLC,QAAS,OACTC,OAAQ,oBACRC,gBAAiB,UACjBC,MAAO,UACPC,aAAc,MACdC,WAAY,aACZC,SAAU,QACd,EAhPK7G,AAiPDA,EAAsBS,YAAY,CAAC0F,QAAQ,EAAI,CAAC,EAChD1E,EAAO0E,QAAQ,EAAI,CAAC,GAE5BW,cAAe,AACX,EArPK9G,AAqPDA,EAAsBS,YAAY,CAACqG,aAAa,EAAI,EAAE,SAC1D,EAAIrF,EAAOqF,aAAa,EAAI,EAAE,GAElCC,SAAUtF,EAAOsF,QAAQ,EAAI,KAC7BC,QAASvF,EAAOuF,OAAO,EAAI,CAAA,EAC3BC,WAAYxF,EAAOwF,UAAU,EAAI,KACjCC,gBAAiBzF,EAAOyF,eAAe,EAAI,IAC3CC,UAAW1F,EAAO0F,SAAS,EAAI,KAC/BC,QAAS3F,EAAO2F,OAAO,EAAI,KAC3BC,gBAAiB5F,EAAO4F,eAAe,EA9P9BrH,AA8PkCA,EAAsBS,YAAY,CAAC4G,eAAe,EAAI,KACjGC,cAAe7F,EAAO6F,aAAa,EA/P1BtH,AA+P8BA,EAAsBS,YAAY,CAAC6G,aAAa,EAAI,KAC3FC,cAAe9F,EAAO8F,aAAa,EAhQ1BvH,AAgQ8BA,EAAsBS,YAAY,CAAC8G,aAAa,EAAI,KAC3FC,iBAAkB/F,EAAO+F,gBAAgB,EAjQhCxH,AAiQoCA,EAAsBS,YAAY,CAAC+G,gBAAgB,EAAI,IACpGC,iBAAkBhG,EAAOgG,gBAAgB,EAAI,CAAC,IAI5CC,EACF,EAAG,IAAIC,IAAI,AACP,EAAGlI,OAAOuB,IAAI,CAACsC,EAASZ,UAAU,UAD3B,CAEP,aACA,WACA,oBACA,kBACA,kBACA,qBACH,IAIDkF,EAAgBvE,CAChB,AAAkB,CAAA,UAAlB,OAAOA,GAAuB,CAACA,EAAOlC,UAAU,CAAC,MAAQmC,EAASuE,QAAQ,EAC1ED,CAAAA,EAAgBtE,EAASuE,QAAQ,CAAGxE,CAAK,EArRhCrD,AAwRbA,EAAsBmD,SAAS,CAAC8B,GAAG,CAACzC,EAAS,CAAEa,OAAQuE,EAAetE,SAAAA,CAAS,GAa/E,IAAA,AAAMwE,eAAN,qBAAMA,WAAAA,GAKE,MAHA,OAFFA,GAKMC,EAAU,GACVC,MAAO,KACPC,SAAU,CAAA,EACVC,OAAQ,KACRC,aAAc1D,KAAKC,GAAG,IAnBN,CACxB0D,MAAO,SAACxG,EAAMyG,UAAWC,EAAMC,aAAa,CAAC,IAAIC,YAAY5G,EAAM,CAC/D6G,QAAS,CAAA,EACTC,SAAU,CAAA,EACVL,OAAAA,CACJ,KACAM,QAAS,kBAAML,EAAMM,MAAM,GAC/B,EAcetF,EAASZ,UAAU,EAAI,CAAC,UAI/B,EAAKmG,YAAY,CAAG,CAAA,EACpB,EAAKC,QAAQ,CAAG,CAAA,EAChB,EAAKC,kBAAkB,CAAG,KAC1B,EAAKC,qBAAqB,CAAG,KAC7B,EAAKC,MAAM,CAAGrI,OAAOsI,MAAM,CAAGtI,OAAOsI,MAAM,CAACC,QAAQ,CAACpB,GAAWA,EAChE,EAAKqB,KAAK,CAAG9F,EAAS+F,MAAM,CAAG,EAAKC,YAAY,CAAC,CAAEC,KAAM,MAAO,KAChE,EAAKC,SAAS,CAAG,KACjB,EAAKC,QAAQ,CAAG,AAAC,SAA+C,OAAvCC,KAAKC,MAAM,GAAGzE,QAAQ,CAAC,IAAI0E,KAAK,CAAC,EAAG,IAC7D,EAAKC,aAAa,CAAG,KACrB,EAAKC,iBAAiB,CAAG1H,SAAS2H,sBAAsB,GACxD,EAAKC,UAAU,CAAG,gBAzBpBlC,OAAAA,IAkCFmC,IAAAA,iCAAAA,SAAyBrI,CAAI,CAAEsI,CAAM,CAAEC,CAAM,EACrCD,IAAWC,IAIX,CAAC,WAAY,oBAAqB,kBAAmB,qBAAqB,CAACC,QAAQ,CAACxI,GAChF,IAAI,CAACiH,YAAY,EACjB,IAAI,CAACwB,UAAU,CAAC,IAAI,CAAC5H,YAAY,CAAC,aAAea,EAAS8D,OAAO,EAC9DxF,AAAS,cAATA,EACP,IAAI,CAAC0I,aAAa,GAElB,IAAI,CAACC,WAAW,CAAC3I,EAAMuI,GAGvB,IAAI,CAACtB,YAAY,EACjB,IAAI,CAAC2B,YAAY,CAAC,UAAW,CAAE5I,KAAAA,EAAMsI,OAAAA,EAAQC,OAAAA,CAAO,GAE5D,IAGAM,IAAAA,0BAAAA,WAKI,GAJA,IAAI,CAACC,YAAY,CAAC,qBAAsB,IAAI,CAAClI,OAAO,EAIhD,IAAI,CAACuG,kBAAkB,CAAE,CACzB4B,aAAa,IAAI,CAAC5B,kBAAkB,EACpC,IAAI,CAACA,kBAAkB,CAAG,KAC1B,MACJ,CAGA,GAAI,IAAI,CAACF,YAAY,CAAE,YACnB,IAAI,CAAC2B,YAAY,CAAC,aAKtB,IAAI,IAAI,CAAC1B,QAAQ,EAIjB,IAAI,CAACA,QAAQ,CAAG,CAAA,EAGhB,IAAI,CAAC8B,kBAAkB,GAGvB,IAAMC,EAAW,IAAI,CAACpI,YAAY,CAAC,YAAca,EAASoC,OAAO,AAC7DmF,AAAa,CAAA,SAAbA,EACA,IAAI,CAACC,iBAAiB,GACjBD,AAAa,SAAbA,EACL,IAAI,CAACE,eAAe,GAEpB,IAAI,CAACC,KAAK,GAGd,IAAI,CAACV,aAAa,GACtB,IAGAW,IAAAA,6BAAAA,qBAWI,EATA,IAAI,CAACC,YAAY,GAGb,IAAI,CAACrB,aAAa,GAClB,IAAI,CAACA,aAAa,CAACsB,UAAU,GAC7B,IAAI,CAACtB,aAAa,CAAG,MAIrB,IAAI,CAACuB,YAAY,EAAI,IAAI,CAACC,YAAY,CAAC,eACvC,IAAI,CAACb,YAAY,CAAC,eAKtB,IAAI,CAACzB,kBAAkB,CAAGuC,WAAW,WAEjC,GAAI,EAAKC,WAAW,CAAE,CAClB,EAAKxC,kBAAkB,CAAG,KAC1B,MACJ,CAGA,EAAKyB,YAAY,CAAC,aAGd,EAAKxB,qBAAqB,EAC1B,EAAKA,qBAAqB,CAACwC,KAAK,GAChC,EAAKhC,SAAS,EACd,EAAKA,SAAS,CAAC2B,UAAU,GACzB,EAAK/B,KAAK,EAAIxI,OAAOsI,MAAM,EAAI,EAAKL,YAAY,EAChDjI,OAAOsI,MAAM,CAACuC,WAAW,CAAC,EAAKrC,KAAK,EAGxC,EAAKP,YAAY,CAAG,CAAA,EACpB,EAAKC,QAAQ,CAAG,CAAA,EAChB,EAAKC,kBAAkB,CAAG,IAC9B,EAAG,IACP,IAGAuB,IAAAA,sBAAAA,sBACI,IAAI,CAACY,YAAY,GACjB,IAAMQ,EAAWC,SAAS,IAAI,CAAClJ,YAAY,CAAC,oBAAsBa,EAASiE,aAAa,EACpF/C,MAAMkH,IAAaA,GAAY,GAInC,CAAA,IAAI,CAAC1B,UAAU,CAAGsB,WAAW,mCAKnBM,mDAJN,GAAI,CAAC,IAAI,CAACL,WAAW,CACjB,cAIAK,CADEA,AACFA,CADEA,EAAM,IAAI,CAACnJ,YAAY,CAAC,aAAea,EAAS8D,OAAM,AAAC,GAClD,IAAI,CAACyB,YAAY,EAAI,CAAC,IAAI,CAACI,MAAM,CAAChB,QAAO,AAAC,EAAjD2D,YACA,SAAM,IAAI,CAACvB,UAAU,CAACuB,EAAK,CAAA,WAA3B,iCAGJ,IAAI,CAACtB,aAAa,SACtB,YAAGoB,EAAQ,CACf,IAGAR,IAAAA,qBAAAA,WACQ,IAAI,CAAClB,UAAU,GACfW,aAAa,IAAI,CAACX,UAAU,EAC5B,IAAI,CAACA,UAAU,CAAG,KAE1B,IAGAc,IAAAA,0BAAAA,sBACUe,EAAczJ,SAAS0J,aAAa,CAAC,MAC3CD,CAAAA,EAAYE,KAAK,CAACC,SAAS,CAAG,MAC9B,IAAI,CAAC5C,KAAK,CAAC6C,WAAW,CAACJ,GACvB,IAAI,CAACrC,SAAS,CAAG,IAAI0C,qBAAqB,SAACtJ,GACnCA,CAAO,CAAC,EAAE,CAACuJ,cAAc,GACzB,EAAKnB,KAAK,GACV,EAAKxB,SAAS,CAAC2B,UAAU,GACzB,EAAK3B,SAAS,CAAG,KAEzB,EAAG,CAAE4C,WAAY,OAAQ,GACzB,IAAI,CAAC5C,SAAS,CAAC6C,OAAO,CAAC,IAAI,CAC/B,IAGAtB,IAAAA,wBAAAA,qBACQ,CAAA,wBAAyBnK,OACzB0L,oBAAoB,kBAAM,EAAKtB,KAAK,IAAI,CAAEuB,QAAS,GAAK,GAExDjB,WAAW,kBAAM,EAAKN,KAAK,IAAI,IAEvC,IAGAwB,IAAAA,0BAAAA,qBACQ,CAAA,IAAI,CAAC3C,aAAa,GAGtB,IAAI,CAACA,aAAa,CAAG,IAAI4C,iBAAiB,SAACC,UAAcA,EAAUpK,OAAO,CAACqK,SAAAA,GACvEA,EAASC,UAAU,CAACtK,OAAO,CAACuK,SAAAA,GAExB,GAAIA,CAAAA,EAAKC,QAAQ,GAAKC,KAAKC,YAAY,EAAIH,EAAKC,QAAQ,GAAKC,KAAKE,SAAQ,AAAC,IAIvEJ,CAAAA,EAAKC,QAAQ,GAAKC,KAAKC,YAAY,EAAIH,EAAKxB,YAAY,CAAC,gBAAe,GAI5E,IAAM6B,EAAW,AAACL,CAAAA,EAAKC,QAAQ,GAAKC,KAAKC,YAAY,CAAGH,EAAKpK,YAAY,CAAC,QAAU,IAAG,GAAM,UACzF0K,EAAY,EAAK/D,KAAK,CAAClF,aAAa,CAAC,AAAC,sBAA8B,OAATgJ,EAAS,MAGpEC,CAAAA,GACAA,EAAUlB,WAAW,CAACY,GAC9B,EACJ,KAGA,IAAI,CAAChD,aAAa,CAACwC,OAAO,CAAC,IAAI,CAAE,CAAEe,UAAW,CAAA,CAAK,GACvD,IAGMxE,IAAAA,eAAN,mCAMUyE,mDALN,GAAI,IAAI,CAACvE,QAAQ,CACb,aACJvH,QAAQ+L,GAAG,CAAC,AAAC,oBAA2B,OAAR9K,EAAQ,SAGlC6K,AACFA,CADEA,EAAiB,IAAI,CAAC5K,YAAY,CAAC,aAAea,EAAS8D,OAAM,AAAC,GAEpE1H,EAAe2B,MAAM,CAACgM,IAGtB/J,EAASe,cAAc,CAAvBf,YACc,SAAMvC,OAAOuD,IAAI,CAAChB,EAAS3C,iBAAiB,UAC1D,SADc,AACRmE,SAAMzD,MAAM,CAACuG,WAAnB,0BAUJ,OANA,IAAI,CAACiB,YAAY,CAAG,CAAA,EACpB,IAAI,CAACI,MAAM,CAAChB,QAAQ,CAAG,CAAA,EACvB,IAAI,CAACgB,MAAM,CAACf,MAAM,CAAG,KACrB,IAAI,CAACe,MAAM,CAACjB,KAAK,CAAG,QAGd,IAAI,CAACgD,KAAK,kBAAhB,eACJ,iBAGMA,IAAAA,cAAN,qCACUuC,EAiBItJ,EAGFuJ,EA4CCC,EAGCC,MAuBOC,0DA1FXJ,EAAYK,YAAYlJ,GAAG,oBAG7B,0BAAI,IAAI,CAACmE,YAAY,CACjB,UAaa,OAVjB,IAAI,CAAC2B,YAAY,CAAC,kBAUK3J,QAAQC,GAAG,EAN9B,AAACwC,EAAS0C,WAAW,CAAC6H,MAAM,EAAIvK,EAAS2C,eAAe,CAAC4H,MAAM,CAAI,IAAI,CAACC,yBAAyB,GAAKjN,QAAQkN,OAAO,GACrH,IAAI,CAACC,eAAe,CAACpG,GACrB,AAACtE,EAAS8D,OAAO,EAAI,IAAI,CAAC3E,YAAY,CAAC,YAAe,IAAI,CAAC4H,UAAU,CAAC,IAAI,CAAC5H,YAAY,CAAC,aAAea,EAAS8D,OAAO,EAAIvG,QAAQkN,OAAO,aAyB9I,OArBM9J,EAAU,AAAC,QAA4B,CAAC,EAAE,CAG5CuJ,EAAa,KACb,AAAClK,EAAS+F,MAAM,EAChBmE,CAAAA,EAAa,IAAI,CAACS,kBAAkB,EAAC,EAGzC,IAAI,CAAC7E,KAAK,CAAC8E,eAAe,GAGtB5K,EAAS+F,MAAM,EAAI/F,EAAS0C,WAAW,CAAC6H,MAAM,EAC9CvK,EAAS0C,WAAW,CAAC1D,OAAO,CAAC6L,SAAAA,GACzB,IAAMC,EAAOhM,SAAS0J,aAAa,CAAC,OACpCsC,CAAAA,EAAKC,GAAG,CAAG,aACXD,EAAKE,IAAI,CAAGH,EACZ,EAAK/E,KAAK,CAAC6C,WAAW,CAACmC,EAC3B,MAIE,IAAI,CAACG,WAAW,CAACtK,EAASuJ,WAWhC,OAXA,SAGIlK,EAAS+F,MAAM,EAAI/F,EAASwD,aAAa,CAAC+G,MAAM,CAAG,GACnD,IAAI,CAACW,qBAAqB,GAG1B,AAAClL,EAAS+F,MAAM,EAChB,IAAI,CAACmD,iBAAiB,MAGpB,IAAI,CAACiC,WAAW,kBAAtB,SAGA,IAAI,CAACC,KAAK,CAAG,CAAEC,SAAUf,YAAYlJ,GAAG,GAAK6I,CAAU,EAGvD,IAAI,CAAC1E,YAAY,CAAG,CAAA,EACpB,IAAI,CAACC,QAAQ,CAAG,CAAA,EAGhB,IAAI,CAAC8F,SAAS,CAAC,SACf,IAAI,CAACpE,YAAY,CAAC,WAGlB,IAAI,CAACoE,SAAS,CAAC,2BACVnB,WACLlM,QAAQsN,KAAK,CAAC,AAAC,UAAiB,OAARrM,EAAQ,KAAIiL,GACpC,IAAI,CAAC3E,QAAQ,CAAG,CAAA,GACV4E,CAAAA,EAAiB,IAAI,CAACjL,YAAY,CAAC,aAAea,EAASyD,QAAO,AAAC,EACrE2G,8BAM2B,+BAHvB,IAAI,CAACtE,KAAK,CAAC8E,eAAe,KAGpB,GAAA,IAAI,EAACK,WAAW,IAAO,IAAI,CAACP,eAAe,CAACN,WAAlD,SAAM,WAAiB,SAA4C,eAGnE,OAHA,YAGM,IAAI,CAACe,WAAW,WAYtB,OAZA,SAGA,IAAI,CAACC,KAAK,CAAG,CAAEC,SAAUf,YAAYlJ,GAAG,GAAK6I,CAAU,EAGvD,IAAI,CAAC1E,YAAY,CAAG,CAAA,EAGpB,IAAI,CAAC+F,SAAS,CAAC,6BAIVjB,WACLpM,QAAQsN,KAAK,CAAC,AAAC,UAAiB,OAARrM,EAAQ,sBAAqBmL,GAErD,IAAI,CAACmB,YAAY,CAAC,AAAC,gBAA2B,OAAZrB,EAAIsB,OAAO,CAAC,iEAIlD,IAAI,CAACD,YAAY,CAACrB,EAAIsB,OAAO,sDAGzC,iBAGM1E,IAAAA,mBAAN,SAAiB8D,CAAG,MAAEa,EAAAA,kFAQZC,EAQAC,EAsHS5L,EAlHL6L,EA+CAnO,EACFoO,EAGAC,EAIAC,EAaMC,EAuCJC,EAMFC,EAGQC,EAGC1M,EASRA,EAiBG,mDApKZ,UAAI,CAACmL,EACD,SAGA,CAAA,IAAI,CAACnF,qBAAqB,EAC1B,IAAI,CAACA,qBAAqB,CAACwC,KAAK,GACpC,IAAI,CAACxC,qBAAqB,CAAG,IAAI2G,gBAC3BV,EAAS,IAAI,CAACjG,qBAAqB,CAACiG,MAAM,CAGhD,IAAI,CAAChG,MAAM,CAAChB,QAAQ,CAAG,CAAA,EACvB,IAAI,CAACgB,MAAM,CAACf,MAAM,CAAG,KACrB,IAAI,CAACe,MAAM,CAACjB,KAAK,CAAG,KAGdkH,EAAY5D,WAAW,kBAAM,EAAKtC,qBAAqB,CAACwC,KAAK,CAAC,YAAYlI,EAASkE,gBAAgB,mBAmDxF,mCA/CP2H,AA+CaA,CA/CbA,EAAe,SAAOS,EAAUC,2BAC9BC,EACEC,EACFC,EASMC,EAUQC,IAEDlN,0DAvBb8M,EAAS,CAAC,EACRC,EAAU,IAAI,CAACtN,YAAY,CAACmN,GAC9BI,EAAU,CACNzM,GAAI,IAAI,CACR4M,IAAK,IAAI,CACTC,MAAO,IAAI,CAACnH,MAAM,CAClBA,OAAQ,IAAI,CAACA,MAAM,CACnBoH,KAAM,IAAI,CAACjH,KAAK,CAChBkH,MAAO,IAAI,CAAClH,KAAK,AACrB,GACA2G,EAAAA,YACME,EAAUF,EAAQQ,IAAI,oBAGxB,yBAAIN,EAAQ9O,UAAU,CAAC,MAAQ8O,EAAQ9O,UAAU,CAAC,KAC9C2O,EAAShQ,KAAK+C,KAAK,CAACoN,EAAQO,OAAO,CAAC,KAAM,WACzC,MAAM,AAAIpM,8EAMF,AAAkB,YAAlB,MADH8L,CAAAA,EAAS,AAAC,AAAIO,SAAS,SAAU,MAAO,AAAC,WAAkB,OAARR,EAAQ,MAAK,IAAI,CAAChH,MAAM,CAAE,IAAI,CAAA,EAC9E,YAA+B,SAAMiH,EAAOQ,IAAI,CAAC,IAAI,CAAEV,oBAAxB,wBAAmCE,0BAA3EJ,wBACK9M,WACLzB,QAAQC,IAAI,CAAC,AAAC,0BAA0CgB,OAAjBoN,EAAS,UAAgB,OAARpN,EAAQ,KAAIQ,uCAM5E6M,EAAAA,sBAEOC,GAGK,AAAqB,YAArB,OAAOD,EAAP,aACM,SAAMA,EAAUa,IAAI,CAAC,IAAI,CAAEV,qBAA3B,0BACAH,qBANlBC,EAAS,yBAGD,GAIK,CAAC,wBAIlB,SAAOA,KACX,WAAA,EAGgC,kBAAmBxM,EAASgE,aAAa,UAC5D,OADPtG,EAAO,YACMmO,EAAa,oBAAqB7L,EAAS+D,eAAe,UA2DhE,OA3DT+H,EAAS,SAGTC,EAAclB,EAClB1O,OAAOmD,OAAO,CAAC5B,GAAMsB,OAAO,CAAC,yBAAEqO,OAAG/Q,cAAOyP,EAAcA,EAAYmB,OAAO,CAAC,AAAC,IAAK,OAAFG,GAAKhR,EAAWC,MAG3F0P,EAAW,IAAIsB,IAAIvB,EAAazO,OAAOiQ,QAAQ,CAACC,MAAM,EACtDrR,OAAOuB,IAAI,CAACoO,GAAQvB,MAAM,CAAG,GAC7ByB,CAAAA,EAASyB,MAAM,CA/uBvC,AA+uB0CC,CA/uB1C,SAA4BC,CAAG,EAC3B,IAAMC,EAAU,IAAIC,gBAEhBC,EAAM,SAAClQ,EAAKmQ,GACR,GAAIA,AAAS,MAATA,GAIJ,GAAI7R,MAAM8R,OAAO,CAACD,GACd,OAAOA,EAAM/O,OAAO,CAAC,SAAC1C,UAAMwR,EAAIlQ,EAAKtB,KAGzC,GAAI,CAAA,SAAOyR,cAAP,EAAOA,EAAI,IAAM,SAAU,KACtB,KAAA,KAAA,aAAL,QAAK,EAAA,EAAgB5R,OAAOmD,OAAO,CAACyO,wBAA/B,GAAA,EAAA,gBAAA,MAAA,QAAA,WAAOV,OAAG/Q,OACXwR,EAAI,AAAC,GAAST,OAAPzP,EAAI,KAAK,OAAFyP,EAAE,KAAI/Q,aADnB,KAAA,gBAAA,SAAA,UAAA,sBAAA,QAAA,GAEL,MACJ,CAGAsR,EAAQK,MAAM,CAACrQ,EAAKvB,EAAW0R,IACnC,EAGC,KAAA,KAAA,aAAL,QAAK,EAAA,EAAgB5R,OAAOmD,OAAO,OAACqO,EAAAA,EAAO,CAAC,wBAAvC,GAAA,EAAA,gBAAA,MAAA,QAAA,WAAON,OAAG/Q,OACXwR,EAAIT,EAAG/Q,aADN,KAAA,gBAAA,SAAA,UAAA,sBAAA,QAAA,GAGL,OAAOsR,CACX,CAAA,EAotB6D9B,GAAQlK,QAAQ,EAAC,EAG1DoK,EAAWA,EAASpK,QAAQ,GAGxB8J,GACAtP,EAAe2B,MAAM,CAACiO,GAGrB5P,EAAe8R,GAAG,CAAClC,KACdC,mBAIKvP,EAKIsD,EARP5B,EAUUgO,EAGD1M,EAMPa,EAKA4N,sDAxBF/P,EAAU,GACVgQ,OAAQ,MACR3N,QAAS,CAAE,OAAU,kBAAmB,GACrC/D,QAAAA,EAjuBdA,AAiuBcA,EAAsBS,YAAY,SAAlCT,EAAoCyH,gBAAgB,GAAI,CAAC,EACzDnE,OAAAA,SAAAA,EAAUmE,gBAAgB,GAAI,CAAC,GAIlC,AAAwC,YAAxC,aAAOnE,UAAAA,EAAAA,EAAUqC,KAAK,SAAfrC,EAAiBsC,WAAW,EAAnC,6BAEqB,gCAAMtC,EAASqC,KAAK,CAACC,WAAW,CAAClE,iBAA5CgO,AACFA,CADEA,EAAW,QAAwC,GACzC,CAAA,SAAOA,cAAP,EAAOA,EAAO,IAAM,UAChChO,CAAAA,EAAUgO,CAAO,sBAChB1M,WACLzB,QAAQC,IAAI,CAAC,AAAC,qCAA4C,OAARgB,EAAQ,KAAIQ,gBAK1D,SAAM6B,MAAMyK,EAAU5N,WAClC,GAAI,CADEmC,AACDA,CADCA,EAAM,QAA6B,EAChCU,EAAE,CACP,MAAM,AAAIH,MAAM,AAAC,cAAwB,OAAXP,EAAIkB,MAAM,GAI5C,GAAI,QADE0M,CAAAA,EAAc5N,EAAIE,OAAO,CAAChC,GAAG,CAAC,eAAc,SAC7C0P,EAAarH,QAAQ,CAAC,qBACvB,MAAM,AAAIhG,MAAM,yBAGb,SAAMP,EAAI2L,IAAI,WAArB,SAAO,YACX,KAGA9P,EAAeuF,GAAG,CAACqK,EAAUC,GAC7BA,EAAUoC,KAAK,CAAC,kBAAMjS,EAAe2B,MAAM,CAACiO,SAI7BzO,QAAQ+Q,IAAI,EAC3BlS,EAAeqC,GAAG,CAACuN,GACnB,IAAIzO,QAAQ,SAACgR,EAAG1N,UAAW8K,EAAO6C,gBAAgB,CAAC,QAAS,kBAAM3N,EAAO,AAAIC,MAAM,aAAa,CAAE2N,KAAM,CAAA,CAAK,kBAI7GtC,EANED,EAAO,SAOT,AAAuC,YAAvC,aAAOlM,UAAAA,EAAAA,EAAUqC,KAAK,SAAfrC,EAAiBwC,UAAU,EAAlC,6BAEmB,gCAAMxC,EAASqC,KAAK,CAACG,UAAU,CAAC0J,iBAA3CE,AACAA,CADAA,EAAW,QAAoC,GACnC,CAAA,SAAOA,cAAP,EAAOA,EAAO,IAAM,UAChCD,CAAAA,EAAgBC,CAAO,sBACtB1M,WACLzB,QAAQC,IAAI,CAAC,AAAC,oCAA2C,OAARgB,EAAQ,KAAIQ,uBAKjE,AAACiM,EAAO+C,OAAO,EACf,CAAA,IAAI,CAAC/I,MAAM,CAACjB,KAAK,CAAGyH,CAAY,gBAIpC,GAFKzM,WAEDiM,EAAO+C,OAAO,CAKd,MAJsB,YAAlB/C,EAAOgD,MAAM,GACb,IAAI,CAAChJ,MAAM,CAACf,MAAM,CAAG,AAAC,2BAAgD,OAAtB5E,EAAS4O,YAAY,CAAC,MACtE,IAAI,CAACjJ,MAAM,CAACjB,KAAK,CAAG,iBAI5BzG,QAAQsN,KAAK,CAAC,AAAC,0BAA6B,OAAJV,GAAOnL,GAC/C,IAAI,CAACiG,MAAM,CAACf,MAAM,CAAGlF,EAAE+L,OAAO,CAC9B,IAAI,CAAC9F,MAAM,CAACjB,KAAK,CAAG,2BAGpB2C,aAAauE,GACRD,EAAO+C,OAAO,EAAI/C,AAAkB,YAAlBA,EAAOgD,MAAM,GAChC,IAAI,CAAChJ,MAAM,CAAChB,QAAQ,CAAG,CAAA,EACnB,QAAA,EAAA,IAAI,CAACe,qBAAqB,SAA1B,EAA4BiG,MAAM,IAAKA,GACvC,CAAA,IAAI,CAACjG,qBAAqB,CAAG,IAAG,2BAGhD,iBAGAwB,IAAAA,qBAAAA,SAAa2H,CAAQ,MAAE9J,EAAAA,uDAAS,CAAC,CACzB/E,CAAAA,EAASqC,KAAK,EAAI,AAAoC,YAApC,OAAOrC,EAASqC,KAAK,CAACwM,EAAS,EACjD7O,EAASqC,KAAK,CAACwM,EAAS,CAACzB,IAAI,CAAC,IAAI,CAAE,GAChCnN,GAAI,IAAI,CACR8M,KAAM,IAAI,CAACjH,KAAK,CAChBgH,MAAO,IAAI,CAACnH,MAAM,EACfZ,GAGf,IAGMyF,IAAAA,kCAAN,mCACUsE,mDAoCN,OApCMA,KAIN9O,EAAS0C,WAAW,CAAC1D,OAAO,CAAC6L,SAAAA,GAEzB,GAAI,CAAC/L,SAAS8B,aAAa,CAAC,AAAC,cAAiB,OAAJiK,EAAI,OAAM,CAChD,IAAMC,EAAOhM,SAAS0J,aAAa,CAAC,OACpCsC,CAAAA,EAAKC,GAAG,CAAG,aACXD,EAAKE,IAAI,CAAGH,EACZ/L,SAASiQ,IAAI,CAACpG,WAAW,CAACmC,EAC9B,CACJ,GAIA9K,EAAS2C,eAAe,CAAC3D,OAAO,CAAC6L,SAAAA,GAC7B,GAAI,CAAChP,EAAgBqS,GAAG,CAACrD,GAAM,CAC3B,IAAMmE,EAAI,IAAIzR,QAAQ,SAACkN,EAAS5J,GAC5B,GAAI/B,SAAS8B,aAAa,CAAC,AAAC,eAAkB,OAAJiK,EAAI,OAAM,YAChDJ,IAGJ,IAAMwE,EAASnQ,SAAS0J,aAAa,CAAC,SACtCyG,CAAAA,EAAO3G,GAAG,CAAGuC,EACboE,EAAOC,KAAK,CAAG,CAAA,EACfD,EAAOE,MAAM,CAAG,kBAAM1E,KACtBwE,EAAOG,OAAO,CAAG,kBAAMvO,EAAO,AAAIC,MAAM,AAAC,0BAA6B,OAAJ+J,MAClE/L,SAASiQ,IAAI,CAACpG,WAAW,CAACsG,EAC9B,GACApT,EAAgB8F,GAAG,CAACkJ,EAAKmE,EAC7B,CACAF,EAASO,IAAI,CAACxT,EAAgB4C,GAAG,CAACoM,GACtC,MAGMtN,QAAQC,GAAG,CAACsR,kBAAlB,eACJ,QAGAnE,IAAAA,2BAAAA,sBASI,IAPI,IAAI,CAACpF,YAAY,EACjB,IAAI,CAACO,KAAK,CAAC/G,gBAAgB,CAAC,mBAAmBC,OAAO,CAAC6K,SAAAA,GACnD,KAAOA,EAAUyF,UAAU,EACvB,EAAK9I,iBAAiB,CAACmC,WAAW,CAACkB,EAAUyF,UAAU,CAC/D,GAGG,IAAI,CAACA,UAAU,EAClB,IAAI,CAAC9I,iBAAiB,CAACmC,WAAW,CAAC,IAAI,CAAC2G,UAAU,EAItD,OAAOpT,MAAMqT,IAAI,CAAC,IAAI,CAAC/I,iBAAiB,CAACgJ,UAAU,EAAEC,MAAM,CAAC,SAACC,EAAOnG,GAEhE,IAAMjL,EAAO,AACTiL,EAAKC,QAAQ,GAAKC,KAAKC,YAAY,EAAIH,EAAKxB,YAAY,CAAC,QACzDwB,EAAKpK,YAAY,CAAC,QAAU,UAGhC,OAAO,OACAuQ,GACH,KAACpR,EAAO,AAACoR,CAAAA,CAAK,CAACpR,EAAK,EAAI,EAAC,AAAC,EAAEqR,MAAM,CAACpG,IAE3C,EAAG,CAAEqG,QAAS,EAAE,AAAC,EACrB,IAGM3E,IAAAA,oBAAN,SAAkBtK,CAAO,CAAEuJ,CAAU,4BAC7B2F,EAIMC,EACFC,EACAC,EAEwB,EAAhBC,EAAMlC,EAaZmC,EAeAC,EAIIC,EACFC,EA+CNC,EA6CI/G,8DAlIN5I,AAAO,EAAPA,EAAmBsB,gBAAnBtB,YACMmP,EAASnP,EAAQ4P,SAAS,GAC5BR,EAAU,IAAIS,YACdR,sBAEwB,SAAMF,EAAOW,IAAI,WACzC,GADQR,EAAgB,CAAA,EAAA,QAAkB,EAAlCA,KAAMlC,EAAU,EAAVA,MACVkC,EACA,mBACJD,EAAYX,IAAI,CAAC,AAAiB,UAAjB,OAAOtB,EAAqBA,EAAQgC,EAAQW,MAAM,CAAC3C,EAAO,CAAE4C,OAAQ,CAAA,CAAK,iBAE9FhQ,EAAUqP,EAAYY,IAAI,CAAC,IAAMb,EAAQW,MAAM,GAE/CzS,QAAQ+L,GAAG,CAAC,2DAqHhB,IAjHI,AAAmB,UAAnB,OAAOrJ,GAEDuP,EAAM,AAAC,IAAIW,YAAaC,eAAe,CAACnQ,EAAS,aAGvDkP,EAAW/Q,SAAS2H,sBAAsB,GAG1C,AACI,EAAGvK,MAAMqT,IAAI,CAACW,EAAInB,IAAI,CAACS,UAAU,UACjC,EAAGtT,MAAMqT,IAAI,CAACW,EAAInO,IAAI,CAACyN,UAAU,IACnCxQ,OAAO,CAACuK,SAAAA,UAAQsG,EAASlH,WAAW,CAACY,MAEvCsG,EAAWlP,EAAQoQ,SAAS,CAAC,CAAA,GAG5B/Q,EAASgR,WAAW,CAiDrBnB,EAAS9Q,gBAAgB,CAAC,SAASC,OAAO,CAACiB,SAAAA,UAAMA,EAAGgR,MAAM,MAhDpDd,EAASjU,MAAMqT,IAAI,CAACM,EAAS9Q,gBAAgB,CAAC,UAGhDiB,EAAS+F,MAAM,EAAI/F,EAASkR,sBAAsB,EAAIpS,SAASqS,kBAAkB,EAC3Ef,EAAcD,EAAOrS,GAAG,CAACsT,SAAAA,UAAKA,EAAEC,WAAW,GAAET,IAAI,CAAC,MACpDP,EAAQ,KAERD,EAAYnD,IAAI,GAAG1C,MAAM,CAAG,IACxB5O,EAAgBuS,GAAG,CAACkC,GACpBC,EAAQ1U,EAAgB8C,GAAG,CAAC2R,IAE5BC,AACAA,CADAA,EAAQ,IAAIiB,aAAc,EACpBC,WAAW,CAACnB,GAClBzU,EAAgBgG,GAAG,CAACyO,EAAaC,KAKzC,IAAI,CAACvK,KAAK,CAACqL,kBAAkB,CAAG,AAC5B,EAAInR,EAAS4C,iBAAiB,aAC9B,EAAIyN,GAASA,QAIjBF,EAAOnR,OAAO,CAACiB,SAAAA,UAAMA,EAAGgR,MAAM,MAG9Bd,EAAOnR,OAAO,CAACyJ,SAAAA,GACX,GAAI,CAACzI,EAAS+F,MAAM,CAEhB,GAAI,iBAAkBzI,OAClBmL,EAAM4I,WAAW,CAAG,AAAC,YAAyD,OAA9C5I,EAAM4I,WAAW,CAACnE,OAAO,CAAC,SAAU,UAAU,UAC3E,CACH,EAAK9F,YAAY,CAAC,aAAc,EAAKjB,QAAQ,EAI7C,IAAMqL,EAAgB,AAAC,GAAyB,OAAvBtS,EAAQ,iBAA6B,OAAd,EAAKiH,QAAQ,CAAC,KAC1DsC,CAAAA,EAAM4I,WAAW,CAACvK,QAAQ,CAAC,UAC3B2B,CAAAA,EAAM4I,WAAW,CAAG5I,EAAM4I,WAAW,CAChCnE,OAAO,CAAC,uBAAwB,AAAC,GAAgB,OAAdsE,EAAc,OACjDtE,OAAO,CAAC,SAAUsE,EAAa,CAE5C,CAER,IAOFlB,KACFtQ,EAASyR,cAAc,CACvB5B,EAAS9Q,gBAAgB,CAAC,UAAUC,OAAO,CAAC0S,SAAAA,GACxC,IAAMC,EAAY7S,SAAS0J,aAAa,CAAC,UACzCtM,MAAMqT,IAAI,CAACmC,EAAUtS,UAAU,EAAEJ,OAAO,CAAC4S,SAAAA,UACrCD,EAAUvK,YAAY,CAACwK,EAAKtT,IAAI,CAAEsT,EAAK7D,KAAK,IAEhD4D,EAAUN,WAAW,CAAGK,EAAUL,WAAW,CAC7Cf,EAAQjB,IAAI,CAACsC,GACbD,EAAUT,MAAM,EACpB,GAEApB,EAAS9Q,gBAAgB,CAAC,UAAUC,OAAO,CAACiB,SAAAA,UAAMA,EAAGgR,MAAM,KAI3D,AAACjR,EAAS+F,MAAM,EAGhB8J,EAAS9Q,gBAAgB,CAAC,QAAQC,OAAO,CAAC6S,SAAAA,GACtC,IAAMvT,EAAOuT,EAAO1S,YAAY,CAAC,SAAW,UAGtC2S,EAAShT,SAAS0J,aAAa,CAAC,MACtCsJ,CAAAA,EAAOrJ,KAAK,CAAC3F,OAAO,CAAG,WACvBgP,EAAO1K,YAAY,CAAC,gBAAiB9I,GAGrC,IAAMyT,EAAgB7H,EAAaA,CAAU,CAAC5L,EAAK,CAAG,KACtD,GAAIyT,GAAiBA,EAAcxH,MAAM,CAAG,EACxCwH,EAAc/S,OAAO,CAACuK,SAAAA,UAAQuI,EAAOnJ,WAAW,CAACY,UAGhD,GAAIsI,EAAOrC,UAAU,CAACjF,MAAM,CAAG,EAChC,KAAOsH,EAAOvC,UAAU,EACpBwC,EAAOnJ,WAAW,CAACkJ,EAAOvC,UAAU,EAI5CuC,EAAOG,WAAW,CAACF,EACvB,GAIGjC,EAASP,UAAU,EAIlB/F,AAAkB,IAHhBA,AAGFA,CAHEA,EAAOsG,EAASP,UAAS,AAAC,EAGvB9F,QAAQ,EACbD,CAAAA,EAAK5D,MAAM,CAAG,IAAI,CAACA,MAAK,AAAC,EAG7B,IAAI,CAACG,KAAK,CAAC6C,WAAW,CAACY,UAI3B+G,EAAQtR,OAAO,CAACoS,SAAAA,UAAK,EAAKtL,KAAK,CAAC6C,WAAW,CAACyI,WAChD,iBAGAlG,IAAAA,8BAAAA,sBACIlL,EAASwD,aAAa,CAACxE,OAAO,CAACiT,SAAAA,GAC3B,EAAKnM,KAAK,CAAC0I,gBAAgB,CAACyD,EAAW,SAACvS,GACpC,EAAKuF,aAAa,CAAC,IAAIC,YAAY+M,EAAW,CAC1C9M,QAAS,CAAA,EACTC,SAAU,CAAA,EACVL,OAAQrF,EAAEqF,MAAM,AACpB,GACJ,EACJ,EACJ,IAGAkC,IAAAA,oBAAAA,SAAY3I,CAAI,CAAEyP,CAAK,EAEnB,GAAIzP,AAAS,aAATA,GAIJ,IAwBI4T,EAxBEC,EAAYnS,EAASZ,UAAU,CAACd,EAAK,CAGrCmB,EAAO,AAAC0S,GAAaA,EAAU1S,IAAI,CAAI0S,EAAU1S,IAAI,CAAG0S,EAC1DC,EAAW,AAAsC,CAAA,IAArCD,CAAAA,GAAaA,EAAUC,QAAO,AAAC,EAC3CC,EAAY,AAACF,GAAaA,EAAUE,SAAS,CAAIF,EAAUE,SAAS,CAAG,KACvEC,EAAe,AAACH,GAAaA,EAAUI,cAAc,CAAC,WAAcJ,EAAUvC,OAAO,CAAG4C,KAAAA,EACxFpU,EAAU,AAAC+T,GAAaA,EAAU/T,OAAO,CAAI+T,EAAU/T,OAAO,CAAG,KACjEqU,EAAS,AAACN,GAAaA,EAAUM,MAAM,CAAIN,EAAUM,MAAM,CAAG,KAGlE,GAAI1E,MAAAA,EAAuC,CACvC,GAAIuE,AAAiBE,KAAAA,IAAjBF,EAA4B,CAC5B,IAAI,CAAC3M,MAAM,CAACrH,EAAK,CAAGgU,EACpB,MACJ,CACIF,GACAnU,QAAQC,IAAI,CAAC,AAAC,gCAA4CgB,OAAbZ,EAAK,UAAgB,OAARY,EAAQ,MAEtE,IAAI,CAACwT,iBAAiB,CAACpU,EAAMmB,GAC7B,MACJ,CAIA,GAAIA,IAASxD,QACTiW,EAAenE,AAAU,OAAVA,GAAkBA,AAAU,UAAVA,OAC9B,GAAItO,IAASzD,OAAQ,CACxB,IAAM2W,EAAM3W,OAAO+R,GACnBmE,EAAchR,MAAMyR,GAAO,EAAIA,CACnC,MAAO,GAAIlT,IAAStD,QAAUsD,IAASvD,MACnC,GAAI,CAEKgW,EADAnE,EACcvR,KAAK+C,KAAK,CAACwO,EAAMb,OAAO,CAAC,KAAM,MADxB,AAACzN,IAASvD,MAAS,EAAE,CAAG,CAAC,CAEvD,CAAE,MAAOwD,EAAG,CACRzB,QAAQC,IAAI,CAAC,AAAC,oBAAwB,OAALI,EAAK,sBAAqByP,GAC3DmE,EAAc,AAACzS,IAASvD,MAAS,EAAE,CAAG,CAAC,CAC3C,MAEAgW,EAAcnE,EAIlB,GAAI3P,GAAWlC,MAAM8R,OAAO,CAAC5P,IAAY,CAACA,EAAQ0I,QAAQ,CAACoL,GAAc,CACrEjU,QAAQC,IAAI,CAAC,AAAC,gBAA+DI,OAAhD4T,EAAY,sCAAiDhT,OAAbZ,EAAK,UAAgB,OAARY,EAAQ,eAAcd,GAC5GkU,AAAiBE,KAAAA,IAAjBF,EACA,IAAI,CAAC3M,MAAM,CAACrH,EAAK,CAAGgU,EACf,AAAsBE,KAAAA,IAAtB,IAAI,CAAC7M,MAAM,CAACrH,EAAK,EACtB,IAAI,CAACoU,iBAAiB,CAACpU,EAAMmB,GACjC,MACJ,CAGA,GAAIgT,GAAUhT,IAAStD,QAAU,CAAA,SAAO+V,cAAP,EAAOA,EAAU,IAAM,UAAYA,AAAgB,OAAhBA,GAC5D/V,OAAOmD,OAAO,CAACmT,GAAQG,IAAI,CAAC,yBAAEvF,OAAGwF,OAC3BrT,EAAM0S,CAAW,CAAC7E,EAAE,QAC1B,AAAYmF,KAAAA,IAARhT,IAEAqT,IAAM9W,OACC,AAAe,UAAf,OAAOyD,EACdqT,IAAM7W,OACC,AAAe,UAAf,OAAOwD,EACdqT,IAAM5W,QACC,AAAe,WAAf,OAAOuD,EACdqT,IAAM3W,MACC,CAACA,MAAM8R,OAAO,CAACxO,GACtBqT,IAAM1W,QACC,CAAA,CAAA,SAAOqD,cAAP,EAAOA,EAAE,IAAM,UAAYtD,MAAM8R,OAAO,CAACxO,IAAQA,AAAQ,OAARA,CAAW,EAE3E,GAAI,CACAvB,QAAQC,IAAI,CAAC,AAAC,4CAAwDgB,OAAbZ,EAAK,UAAgB,OAARY,EAAQ,OAC1EoT,AAAiBE,KAAAA,IAAjBF,EACA,IAAI,CAAC3M,MAAM,CAACrH,EAAK,CAAGgU,EACf,AAAsBE,KAAAA,IAAtB,IAAI,CAAC7M,MAAM,CAACrH,EAAK,EACtB,IAAI,CAACoU,iBAAiB,CAACpU,EAAMmB,GACjC,MACJ,CAIJ,GAAI4S,GAAa,AAAqB,YAArB,OAAOA,GAChB,CAACA,EAAUH,GAAc,CACzBjU,QAAQC,IAAI,CAAC,AAAC,qCAAiDgB,OAAbZ,EAAK,UAAgB,OAARY,EAAQ,aAAYgT,GAE/EI,AAAiBE,KAAAA,IAAjBF,EACA,IAAI,CAAC3M,MAAM,CAACrH,EAAK,CAAGgU,EAEf,AAAsBE,KAAAA,IAAtB,IAAI,CAAC7M,MAAM,CAACrH,EAAK,EACtB,IAAI,CAACoU,iBAAiB,CAACpU,EAAMmB,GAEjC,MACJ,CAGJ,IAAI,CAACkG,MAAM,CAACrH,EAAK,CAAG4T,EACxB,IAGAQ,IAAAA,0BAAAA,SAAkBpU,CAAI,CAAEmB,CAAI,EACpBA,IAASzD,OACT,IAAI,CAAC2J,MAAM,CAACrH,EAAK,CAAG,EACfmB,IAASxD,QACd,IAAI,CAAC0J,MAAM,CAACrH,EAAK,CAAG,CAAA,EACfmB,IAASvD,MACd,IAAI,CAACyJ,MAAM,CAACrH,EAAK,CAAG,EAAE,CACjBmB,IAAStD,OACd,IAAI,CAACwJ,MAAM,CAACrH,EAAK,CAAG,CAAC,EACpB,IAAI,CAACqH,MAAM,CAACrH,EAAK,CAAG,EAC7B,IAGAgJ,IAAAA,2BAAAA,sBACIlD,EAAcpF,OAAO,CAACV,SAAAA,UAAQ,EAAK2I,WAAW,CAAC3I,EAAM,EAAKa,YAAY,CAACb,KAC3E,IAGAwU,IAAAA,yBAAAA,sBACU7M,EAAO,IAAI,CAAC9G,YAAY,CAAC,YAAca,EAAS0D,OAAO,CAC7D,GAAKuC,GAIL,IAAM8M,EAAU,AAAC9M,AAAS,UAATA,EAAoB+M,aAAeC,eAChDrV,EAAM,IAAI,CAACuB,YAAY,CAAC,gBAAkBa,EAAS2D,UAAU,EACzD,AAAC,OAAwB,OAAlB,IAAI,CAACuP,SAAS,CAAC,KAAqC,OAAlC,IAAI,CAACC,EAAE,CAAG,IAAM,IAAI,CAACA,EAAE,CAAG,SACvDC,EAAa/K,SAAS,IAAI,CAAClJ,YAAY,CAAC,qBAAuBa,EAAS4D,eAAe,EAAI,MAAO,IAGlGyP,EAAS,KAGPC,EAAc,kBAAMnX,OAAOkD,WAAW,CACxClD,OAAOmD,OAAO,CAAC,EAAKqG,MAAM,EACrBhI,MAAM,CAAC,yBAAE0P,OAAG/Q,aAAO,CAAC+Q,EAAExP,UAAU,CAAC,MAAQ,AAAa,YAAb,OAAOvB,MAInDiX,EAAU,SAACxF,GACTsF,GACAhM,aAAagM,GACjBA,EAAS,KACTN,EAAQS,OAAO,CAAC5V,EAAKpB,KAAKC,SAAS,CAACsR,GAASuF,KACjD,CAGA,CAAA,IAAI,CAAC3N,MAAM,CAAC8N,YAAY,CAAG,CACvBC,KAAM9V,EACN+V,MAAO,SAAC5F,GACAqF,EAAa,GACTC,GACAhM,aAAagM,GACjBA,EAASrL,WAAW,kBAAMuL,EAAQxF,IAAQqF,IAE1CG,EAAQxF,EAEhB,EACA6F,OAAQ,WACAP,GACAhM,aAAagM,GACjBA,EAAS,KACTN,EAAQc,UAAU,CAACjW,EACvB,EACAkW,KAAM,eAACzG,yDAAI,KAAM5J,yDAAW,KACxB,GAAI,CACA,IAAIsQ,EAASvX,KAAK+C,KAAK,CAACwT,EAAQiB,OAAO,CAACpW,IACxC,MAAO,AAACyP,CAAAA,EAAI0G,CAAM,CAAC1G,EAAE,CAAG0G,CAAK,GAAMtQ,CACvC,CAAE,MAAO/D,EAAG,CACR,OAAO+D,CACX,CACJ,EACAwQ,OAAQ,WACAZ,GACAE,GACR,CACJ,EAGA,GAAI,CACA,IAAMQ,EAAS,IAAI,CAACpO,MAAM,CAAC8N,YAAY,CAACK,IAAI,GAC5C,GAAIC,GAAU,CAAA,SAAOA,cAAP,EAAOA,EAAK,IAAM,SAC5B,IAAK,IAAM1G,KAAK,IAAI,CAAC1H,MAAM,CACnBxJ,OAAO+X,SAAS,CAAC3B,cAAc,CAACnF,IAAI,CAAC2G,EAAQ1G,IAC7C,CAAA,IAAI,CAAC1H,MAAM,CAAC0H,EAAE,CAAG0G,CAAM,CAAC1G,EAAC,AAAC,CAC1C,CAAE,MAAO3N,EAAG,CACRzB,QAAQC,IAAI,CAAC,AAAC,4BAA+B,OAAJN,GAAO8B,EACpD,CAGAkG,OAAOuO,MAAM,CAAC,kBAAM,EAAKxO,MAAM,CAAC8N,YAAY,CAACE,KAAK,CAACL,OAG/CF,EAAa,GACb9V,OAAOkR,gBAAgB,CAAC,eAAgB,kBAAM,EAAK7I,MAAM,CAAC8N,YAAY,CAACQ,MAAM,KACrF,IAGM9I,IAAAA,oBAAN,qEACI,QAAI7N,OAAOsI,MAAM,KACN,IAAI,CAACwO,iBAAiB,OAG1B,IAAI7W,QAAQ,SAACkN,EAAS5J,GACzB/B,SAAS0P,gBAAgB,CAAC,cAAe,WACrC,EAAK4F,iBAAiB,GACtB3J,GACJ,EAAG,CAAEgE,KAAM,CAAA,CAAK,GAGhBzG,WAAW,WACH1K,OAAOsI,MAAM,EACb,EAAKwO,iBAAiB,GACtB3J,KAGA5J,EAAO,AAAIC,MAAM,iCACzB,EAAG,IACP,KACJ,iBAGAsT,IAAAA,0BAAAA,sBAEUC,EAAY,IAAI,CAAClV,YAAY,CAAC,eAAiBa,EAAS6D,SAAS,CACvE,GAAIwQ,EAAW,CACX,IAAIC,EAAQ1O,OAAO0O,KAAK,CAACD,GACrBC,GAEI,IAAI,CAAC3O,MAAM,EAAI,AAAuB,WAAvB,EAAO,IAAI,CAACA,MAAM,GACjCxJ,OAAOuB,IAAI,CAAC,IAAI,CAACiI,MAAM,EAClBhI,MAAM,CAACC,SAAAA,UAAO0W,AAAe9B,KAAAA,IAAf8B,CAAK,CAAC1W,EAAI,GACxBoB,OAAO,CAACpB,SAAAA,UAAO0W,CAAK,CAAC1W,EAAI,CAAG,EAAK+H,MAAM,CAAC/H,EAAI,GAGrD,IAAI,CAAC+H,MAAM,CAAG2O,IAEdrW,QAAQsN,KAAK,CAAC,AAAC,gBAAyB,OAAV8I,EAAU,8CACxC,IAAI,CAAC1O,MAAM,CAAGrI,OAAOsI,MAAM,CAACC,QAAQ,CAAC,IAAI,CAACF,MAAM,EAAI,CAAC,GAE7D,MAEI,IAAI,CAACA,MAAM,CAAGrI,OAAOsI,MAAM,CAACC,QAAQ,CAAC,IAAI,CAACF,MAAM,EAAI,CAAC,GAIzD,IAAI,CAACmN,gBAAgB,GAIrBlN,OAAOuO,MAAM,CAAC,WACN,EAAKxO,MAAM,GACXxJ,OAAOuB,IAAI,CAAC,EAAKiI,MAAM,EAAE3G,OAAO,CAACqO,SAAAA,GACzBA,AAAM,iBAANA,GACK,EAAK1H,MAAM,CAAC0H,EAAE,AAC3B,GACA,EAAK1H,MAAM,CAACd,YAAY,CAAG1D,KAAKC,GAAG,GAE3C,GAGAwE,OAAO0O,KAAK,CAAC,AAAC,SAAmBlO,OAAXlH,EAAQ,KAAuC,OAApCkH,KAAKC,MAAM,GAAGzE,QAAQ,CAAC,IAAI0E,KAAK,CAAC,IAAM,IAAI,CAACX,MAAM,EAI/E,IAAI,CAACG,KAAK,EAAI,IAAI,CAACA,KAAK,CAACyO,QAAQ,EACjCrY,MAAMqT,IAAI,CAAC,IAAI,CAACzJ,KAAK,CAACyO,QAAQ,EAAEvV,OAAO,CAACuK,SAAAA,GAChCA,AAAkB,IAAlBA,EAAKC,QAAQ,EACbD,CAAAA,EAAK5D,MAAM,CAAG,EAAKA,MAAK,AAAC,CACjC,GAGJrI,OAAOsI,MAAM,CAAC4O,QAAQ,CAAC,WACf,EAAK1O,KAAK,EACVxI,OAAOsI,MAAM,CAAC6O,QAAQ,CAAC,EAAK3O,KAAK,CACzC,EACJ,IAGA0F,IAAAA,qBAAAA,SAAakJ,CAAG,EACZ,IAAM7K,EAAY/K,SAAS0J,aAAa,CAAC,MACzCqB,CAAAA,EAAUpB,KAAK,CAACkM,OAAO,CAx2C5BxY,OAAOmD,OAAO,CAw2C6BU,EAAS6C,QAAQ,EAv2C9D/E,GAAG,CAAC,yBAAEuP,OAAG/Q,aAAO,AAAC,GAAqDA,OAAnD+Q,EAAEH,OAAO,CAAC,SAAU0H,SAAAA,SAAK,AAAC,IAAmB,OAAhBA,EAAEC,WAAW,MAAM,KAAK,OAAFvY,KACtEsU,IAAI,CAAC,KAw2CE,IAAMkE,EAAShW,SAAS0J,aAAa,CAAC,SACtCsM,CAAAA,EAAOzD,WAAW,CAAG,AAAC,iBAAwB,OAARnS,EAAQ,KAE9C,IAAM6V,EAAOjW,SAAS0J,aAAa,CAAC,OACpCuM,CAAAA,EAAK1D,WAAW,CAAGqD,EACnBK,EAAKtM,KAAK,CAAC3F,OAAO,CAAG,QACrBiS,EAAKtM,KAAK,CAACuM,SAAS,CAAG,MACvBnL,EAAUlB,WAAW,CAACmM,GACtBjL,EAAUlB,WAAW,CAACoM,GAElB/U,EAAS+F,MAAM,CACf,IAAI,CAACD,KAAK,CAAC8E,eAAe,CAACf,GAE3B,IAAI,CAAC/D,KAAK,CAAC6C,WAAW,CAACkB,EAC/B,IAGAyB,IAAAA,kBAAAA,SAAU2G,CAAS,EACf,IAAI,CAAChN,aAAa,CAAC,IAAIC,YAAY+M,EAAW,CAC1C9M,QAAS,CAAA,EACTC,SAAU,CAAA,EACVL,OAAQ,CAAE+H,MAAO,IAAI,CAACnH,MAAM,AAAC,CACjC,GACJ,IAGM+E,IAAAA,wBAAN,SAAsB3K,CAAM,uEACjB,SA/1CFrD,AA+1CQA,EAAsBoD,YAAY,CAACC,EAAQC,WAAxD,SAAO,YACX,QAIMiV,IAAAA,oBAAN,gFAA6B,SAp2CpBvY,AAo2C0BA,EAAsBwY,UAAU,CAAClV,EAAS5C,oBAAoB,CAAE4C,EAAS3C,iBAAiB,UAAvG,SAAO,YAAmG,QAC1H8X,IAAAA,oBAAN,gFAA6B,SAr2CpBzY,AAq2C0BA,EAAsBsB,UAAU,CAACgC,EAAS3C,iBAAiB,UAAxE,SAAO,YAAoE,UAniCtF+X,IAAAA,yBAAX,WACI,OAAOhR,CACX,KA/BEI,KAAgC6Q,cAokCtC7W,eAAeE,MAAM,CAACQ,EAASsF,EACnC,KA12CiB9H,KACjB,EADiBA,EACVE,WAAW,CAAA,GAClB,EAFiBF,EAEVmD,YAAY,IAAIjE,KACvB,EAHiBc,EAGV4Y,YAAY,CAAA,GAGnB,EANiB5Y,EAMVS,eAAe,CAClBoY,MAAO,CAAA,EACPhR,SAAU,GACV1B,SAAU,CAAC,EACXkD,OAAQ,CAAA,EACRmL,uBAAwB,CAAA,EACxBtO,kBAAmB,EAAE,CACrB6O,eAAgB,CAAA,EAChBT,YAAa,CAAA,EACbxN,cAAe,EAAE,CACjBd,YAAa,EAAE,CACfC,gBAAiB,EAAE,CACnBpE,qBAAsB,gBACtBK,mBAAoB,cAGpBmF,gBAAiB,KACjBC,cAAe,KACfC,cAAe,KACfC,iBAAkB,IAGlBnD,eAAgB,CAAA,EAChByU,sBAAuB,QACvBpY,qBAAsB,2BACtBC,kBAAmB,gCACnBgE,qBAAsB,GAC1B,GA60CJ,IAAA,AAAM1C,eAAN,qBAAMA,IAAN,cAAMA,GAAN,OAAMA,sBAAAA,OAAAA,IACIwI,IAAAA,0BAAN,mCACUmB,EAOFpJ,EAWEf,EAYG,EAAA,EAAA,EAAA,EAAA,EAAMyT,EAQDpS,EAGFiW,EAcNC,EAGD,EAAA,EAAA,EAAA,EAAA,EAAM9D,4BAzDX,GAAI,CADEtJ,CAAAA,EAAM,IAAI,CAACnJ,YAAY,CAAC,QAAU,IAAI,CAACA,YAAY,CAAC,MAAK,EAG3D,OADAlB,QAAQsN,KAAK,CAAC,AAAC,IAAkB,OAAf,IAAI,CAAC2H,SAAS,CAAC,mCAUrC,GALIhU,AACA,CADAA,EAAU,IAAI,CAACC,YAAY,CAAC,MAAK,GAEjCD,CAAAA,EAAU,AAACoJ,EAAIqN,KAAK,CAAC,KAAKC,GAAG,GAAID,KAAK,CAAC,KAAKE,KAAK,EAAC,EAGlD,CAAC3W,EAAQ4H,QAAQ,CAAC,KAElB,OADA7I,QAAQsN,KAAK,CAAC,AAAC,IAAiCrM,OAA9B,IAAI,CAACgU,SAAS,CAAC,iBAAuB,OAARhU,EAAQ,iCAe5D,GAVMf,EAAS,CACX4H,OAAQ,IAAI,CAACgC,YAAY,CAAC,UAAa,AAAgC,UAAhC,IAAI,CAAC5I,YAAY,CAAC,UAAyBzC,EAAsBS,YAAY,CAAC4I,MAAM,CAC3H3D,QAAS,IAAI,CAACjD,YAAY,CAAC,YAAc,QACzC2E,QAAS,IAAI,CAAC3E,YAAY,CAAC,aAAe,KAC1C0E,UAAW,IAAI,CAAC1E,YAAY,CAAC,eAAiB,KAC9CsE,SAAU,IAAI,CAACtE,YAAY,CAAC,aAAe,KAC3CC,WAAY,CAAC,CACjB,EAGI,CAACZ,eAAeC,GAAG,CAACS,GAAU,CAEzB,KAAA,KAAA,aAAL,IAAK,EAAc,IAAI,CAACE,UAAU,sBAA7B,GAAA,EAAA,gBAAA,KAAMwS,EAAN,QACG,CACA,MAAO,MAAO,MAAO,SAAU,UAAW,QAAS,QAAS,KAAM,aAAc,WAChF,WAAY,kBAAmB,oBAAqB,qBAAsB,mBAC5E9K,QAAQ,CAAC8K,EAAKtT,IAAI,IAIdkB,EAAMoS,EAAK7D,KAAK,CAACd,IAAI,GAGvBwI,EAAe1Z,OACfyD,EAAI3B,UAAU,CAAC,MAAQ2B,EAAI3B,UAAU,CAAC,KAAM4X,EAAe,AAACjW,EAAI3B,UAAU,CAAC,KAAQ3B,MAAQC,OACtFqD,AAAQ,SAARA,GAAkBA,AAAQ,UAARA,GAAmBA,AAAQ,KAARA,EAAYiW,EAAexZ,QAChE,AAACiF,MAAMlF,OAAOwD,KAAOiW,CAAAA,EAAezZ,MAAK,EAGlDmC,EAAOiB,UAAU,CAACwS,EAAKtT,IAAI,CAAC,CAAGmX,YAjB9B,KAAA,gBAAA,SAAA,UAAA,sBAAA,QAAA,GAqBL/Y,EAAsBgC,MAAM,CAACQ,EAASoJ,EAAKnK,EAC/C,CAGMuX,EAAc5W,SAAS0J,aAAa,CAACtJ,GAGtC,KAAA,KAAA,aAAL,IAAK,EAAc,IAAI,CAACE,UAAU,sBAA7B,GAAA,EAAA,gBAAA,KAAMwS,EAAN,QACG,CAAC,MAAO,MAAO,MAAO,UAAU9K,QAAQ,CAAC8K,EAAKtT,IAAI,GAEtDoX,EAAYtO,YAAY,CAACwK,EAAKtT,IAAI,CAAEsT,EAAK7D,KAAK,WAH7C,KAAA,gBAAA,SAAA,UAAA,sBAAA,QAAA,GAOL,KAAO,IAAI,CAACuB,UAAU,EAClBoG,EAAY/M,WAAW,CAAC,IAAI,CAAC2G,UAAU,SAG3C,IAAI,CAAC0C,WAAW,CAAC0D,QACrB,kBAxEE/W,KAAgC0W,cA4EtC,AAAMxW,eAAN,qBAAMA,wBAAAA,GAOE,GADA,OANFA,IAOOuB,MAAM,CAAG,IAAIxE,eAPpBiD,OAAAA,IAUF8H,IAAAA,iCAAAA,SAAyBrI,CAAI,CAAEsI,CAAM,CAAEC,CAAM,EACrCvI,AAAS,OAATA,GAAiBuI,GAAUA,IAAWD,GACtC,IAAI,CAACkP,OAAO,CAACjP,EACrB,IAEAM,IAAAA,0BAAAA,WACI,IAAI,CAACC,YAAY,CAAC,qBAAsB,eACpC,CAAC,IAAI,CAAC2O,iBAAiB,EAAI,IAAI,CAAC5W,YAAY,CAAC,OAC7C,IAAI,CAAC2W,OAAO,CAAC,IAAI,CAAC3W,YAAY,CAAC,MACvC,IAEAwI,IAAAA,6BAAAA,WAEI,IAAI,CAACvH,MAAM,CAACpB,OAAO,CAACiB,SAAAA,GACZA,EAAG6F,KAAK,EAAIxI,OAAOsI,MAAM,EACzBtI,OAAOsI,MAAM,CAACuC,WAAW,CAAClI,EAAG6F,KAAK,CAC1C,GACA,IAAI,CAAC1F,MAAM,CAAC4V,KAAK,EACrB,IAGMF,IAAAA,gBAAN,SAAcG,CAAG,4BAKPC,EA6DIhZ,EAQA+C,mDAzEV,UAAI,CAACgW,EACD,aACJA,EAAMA,EAAIpB,WAAW,GAEfqB,EAAY,WACd,IA2BIjW,EA3BEkW,EAAY,EAAKpO,YAAY,CAAC,cAChC7K,EAAU,EAAK6Y,iBAAiB,CA2BpC,GAxBI7Y,GAAWiZ,GAEXjZ,EAAQkZ,YAAY,CAAGlZ,EAAQmZ,SAAS,CAGxCnZ,EAAQ4K,YAAY,CAAG,CAAA,EACvB,EAAK1H,MAAM,CAACuB,GAAG,CAACzE,EAAQgC,OAAO,CAAC2V,WAAW,GAAI3X,GAG/CA,EAAQ+T,MAAM,GAGd/T,EAAQ4K,YAAY,CAAG,CAAA,IAGvB,EAAK8C,eAAe,GAGhB1N,GAAW,CAACiZ,GACZ,EAAK/V,MAAM,CAACrC,MAAM,CAACb,EAAQgC,OAAO,CAAC2V,WAAW,KAKlDsB,GAAa,EAAK/V,MAAM,CAAC8N,GAAG,CAAC+H,GAC7BhW,AAGIA,CAHJA,EAAK,EAAKG,MAAM,CAAC3B,GAAG,CAACwX,EAAG,EAGjBG,YAAY,EACfpO,WAAW,kBAAM/H,EAAGoW,SAAS,CAAGpW,EAAGmW,YAAY,EAAE,QAErD,GAAI,CACAnW,EAAKnB,SAAS0J,aAAa,CAACyN,GAE5B/Z,MAAMqT,IAAI,CAAC,EAAKnQ,UAAU,EAAEJ,OAAO,CAAC4S,SAAAA,GAC5B,AAAC,CAAC,KAAM,aAAa,CAAC9K,QAAQ,CAAC8K,EAAKtT,IAAI,GACxC2B,EAAGmH,YAAY,CAACwK,EAAKtT,IAAI,CAAEsT,EAAK7D,KAAK,CAC7C,EACJ,CAAE,MAAOrO,EAAG,CACRzB,QAAQsN,KAAK,CAAC,AAAC,4BAA+B,OAAJ0K,EAAI,KAAIvW,EACtD,CAQJ,OAJIO,GACA,EAAK0I,WAAW,CAAC1I,GAGdA,CACX,GAGInB,SAASwX,mBAAmB,CAA5BxX,mBACAA,SAASwX,mBAAmB,CAAC,kBAAMJ,uBAG7BhZ,CAAAA,EAAU,IAAI,CAAC6Y,iBAAgB,AAAC,EAClC7Y,YAGA,OAFAA,EAAQuL,KAAK,CAAC8N,UAAU,CAAG,wBAC3BrZ,EAAQuL,KAAK,CAAC+N,OAAO,CAAG,OAClB,IAAIjZ,QAAQkZ,SAAAA,UAAKzO,WAAWyO,EAAG,eAArC,0BAIExW,CAAAA,EAAKiW,GAAU,IAEjBjW,EAAGwI,KAAK,CAAC+N,OAAO,CAAG,IACnBvW,EAAGwI,KAAK,CAAC8N,UAAU,CAAG,uBACtBG,sBAAsB,WAClBzW,EAAGwI,KAAK,CAAC+N,OAAO,CAAG,IACnBxO,WAAW,WACP/H,EAAGwI,KAAK,CAAC8N,UAAU,CAAG,GACtBtW,EAAGwI,KAAK,CAAC+N,OAAO,CAAG,EACvB,EAAG,IACP,iCAGZ,mBArHWpB,IAAAA,yBAAX,WACI,MAAO,CAAC,KAAK,AACjB,KAHEvW,KAA4BwW,cA0HlC,GAAI,CACIvW,AAAwB,YAAxBA,SAAS6X,UAAU,CACnBrZ,OAAOkR,gBAAgB,CAAC,mBAAoB9R,EAAsBC,KAAK,CAAE,CAAE8R,KAAM,CAAA,CAAK,GAEtF/R,EAAsBC,KAAK,EAEnC,CAAE,MAAO+C,EAAG,CACRzB,QAAQC,IAAI,CAAC,uCAAwCwB,EACzD,QA5jDqBhD","file":"AlpineComponentLoader.min.js","sourcesContent":["/**\n * @license AlpineComponentLoader\n *\n * Copyright (c) LTDev LLC\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n// Cache for constructible stylesheets (Internal styles only)\nconst styleSheetCache = new Map();\n\n// Cache for External Script loading states (Prevent duplicate execution)\nconst scriptLoadCache = new Map();\n\n// Type map for prop attribute definitions\nconst typeMap = {\n    'String': String,\n    'Number': Number,\n    'Boolean': Boolean,\n    'Array': Array,\n    'Object': Object\n};\n\n// Cache for xxternal data requests (Prevent duplicate API calls)\nconst dataFetchCache = new Map();\n\n// Helper to convert JS style objects to CSS strings\nconst toCssString = (styleObj) => {\n    return Object.entries(styleObj)\n        .map(([k, v]) => `${k.replace(/[A-Z]/g, m => `-${m.toLowerCase()}`)}:${v}`)\n        .join(';');\n};\n\n// Helper to ensure values are string-safe for URLs (stringifies objects/arrays)\nconst toUrlValue = (v) => encodeURIComponent((typeof v === 'object' && v !== null) ? JSON.stringify(v) : v);\n\n// Helper to convert JS objects to URLSearchParams (supports nested objects and arrays)\nfunction toSearchParamsDeep(obj) {\n    const _params = new URLSearchParams(),\n        // Support nested objects and arrays in query parameters\n        add = (key, value) => {\n            if (value == null)\n                return;\n\n            // Support arrays\n            if (Array.isArray(value))\n                return value.forEach((v) => add(key, v));\n\n            // Support nested objects\n            if (typeof value === \"object\") {\n                for (const [k, v] of Object.entries(value))\n                    add(`${key}[${k}]`, v);\n                return;\n            }\n\n            // Add parameter\n            _params.append(key, toUrlValue(value));\n        };\n\n    // Add parameters\n    for (const [k, v] of Object.entries(obj ?? {}))\n        add(k, v);\n\n    return _params;\n}\n\nexport default class AlpineComponentLoader {\n    static _started = false;\n    static _registry = new Map();\n    static _debugger = false;\n\n    // Global default configuration\n    static globalConfig = {\n        debug: false,\n        basePath: '',\n        errorCss: {},\n        shadow: false,\n        useConstructibleStyles: true,\n        sharedStyleSheets: [],\n        executeScripts: true,\n        stripStyles: false,\n        forwardEvents: [],\n        externalCss: [],\n        externalScripts: [],\n        defaultComponentName: 'acl-component',\n        defaultDynamicName: 'acl-dynamic',\n\n        // Data fetching\n        dataFetchParams: null,\n        dataFetchKeys: null,\n        dataFetchPoll: null,\n        dataFetchTimeout: 30000,\n\n        // Template caching\n        cacheTemplates: true,\n        _templateCacheVersion: '0.0.1',\n        _templateCachePrefix: 'alpine-component-loader-',\n        _templateCacheKey: `alpine-component-loader-0.0.1`,\n        _templateCacheExpire: 15 * 60 * 1000,\n    };\n\n    // Start loading components + setup component proxy\n    static async start() {\n        if (AlpineComponentLoader._started)\n            return;\n        AlpineComponentLoader._started = true;\n\n        // Cleanup old caches\n        await AlpineComponentLoader.pruneCaches();\n\n        // Register default components\n        AlpineComponentLoader.registerComponent();\n        AlpineComponentLoader.registerDynamicLoader();\n        AlpineComponentLoader.registerTemplates();\n    }\n\n    // Clear caches from unmatched versions\n    static async pruneCaches(prefix = AlpineComponentLoader.globalConfig._templateCachePrefix, current = AlpineComponentLoader.globalConfig._templateCacheKey) {\n        if (!('caches' in window))\n            return;\n        return await Promise.all((await caches.keys())\n            .filter(key => key.startsWith(prefix))\n            .filter(key => key !== current)\n            .map(key => caches.delete(key)));\n    }\n\n    // Manually clear all template caches\n    static async clearCache(current = AlpineComponentLoader.globalConfig._templateCacheKey) {\n        if (!('caches' in window)) {\n            console.warn('[ACL] Cache API not supported.');\n            return;\n        }\n\n        // Clear all caches with the specified prefix\n        return await Promise.all((await caches.keys())\n            .filter(key => key.startsWith(current))\n            .map(key => caches.delete(key)));\n    }\n\n    // Update global configuration\n    static config(options) {\n        Object.assign(AlpineComponentLoader.globalConfig, options);\n    }\n\n    // Register default custom component\n    static registerComponent(name = AlpineComponentLoader.globalConfig.defaultComponentName) {\n        if (!customElements.get(name))\n            customElements.define(name, AlpineDeclarativeLoader);\n    }\n\n    // Register default dynamic loader\n    static registerDynamicLoader(name = AlpineComponentLoader.globalConfig.defaultDynamicName) {\n        if (!customElements.get(name))\n            customElements.define(name, AlpineDynamicLoader);\n    }\n\n    // Auto-discover <template acl-component=\"name\"> elements\n    static registerTemplates() {\n        document.querySelectorAll('template[acl-component]').forEach(tpl => {\n            const tagName = tpl.getAttribute('acl-component');\n            if (!tagName)\n                return;\n\n            // Parse acl-props attribute as JSON\n            let config;\n            try {\n                config = {\n                    attributes: Object.fromEntries(Object.entries(JSON.parse(tpl.getAttribute('acl-props') || '{}')).map(([key, val]) => [\n                        key,\n                        (typeof val === 'object' && val.type) ? {\n                            ...val,\n                            type: typeMap[val.type] || String\n                        } : (typeMap[val] || String)\n                    ]))\n                }\n            } catch (e) {\n                console.warn(`[ACL] Invalid JSON in acl-props for <${tagName}>`, e);\n            }\n\n            // Define the component\n            AlpineComponentLoader.define(tagName, tpl, config || {});\n        });\n    }\n\n    // Toggle the built-in debugger\n    static toggleDebug() {\n        console.warn('[ACL] Debugger not loaded. Import \\\"acl-debugger.js\\\" to enable.');\n    }\n\n    // Prefetch a component's template by tag name to warm the cache\n    static async prefetch(tagName) {\n        const config = AlpineComponentLoader._registry.get(tagName);\n        if (!config) {\n            console.warn(`[ACL] Cannot prefetch <${tagName}>: component not defined.`);\n            return;\n        }\n        return await AlpineComponentLoader.loadTemplate(config.source, config.settings);\n    }\n\n    // Centralized static template loader for components\n    static async loadTemplate(source, settings) {\n        // Handle HTMLTemplateElement or ID selector\n        if (source instanceof HTMLTemplateElement) {\n            return source.content;\n        } else if (typeof source === 'string' && source.startsWith('#')) {\n            const el = document.querySelector(source);\n            if (!el)\n                return Promise.reject(new Error(`Template ID \"${source}\" not found`));\n            if (!(el instanceof HTMLTemplateElement))\n                return Promise.reject(new Error(`ID \"${source}\" is not a <template>`));\n            return el.content;\n        }\n\n        // Check Cache API\n        const useCache = settings.cacheTemplates && 'caches' in window,\n            faH = 'acl__fetched-at__';\n\n        // Cache API\n        let _cache;\n        if (useCache) {\n            try {\n                // Open cache\n                _cache = await caches.open(settings._templateCacheKey);\n\n                // Read from cache + check expiration\n                const match = await _cache.match(source);\n                if (match?.ok) {\n                    const fetchedAt = Number(match.headers.get(faH));\n                    if (!Number.isNaN(fetchedAt) && (Date.now() - fetchedAt) < settings._templateCacheExpire)\n                        return match.text();\n                    await _cache.delete(settings._templateCacheKey);\n                }\n            } catch { /* Ignore cache read errors */ }\n        }\n\n        // Network fetch\n        const res = await fetch(source, { cache: 'no-store' });\n        if (!res.ok)\n            throw new Error(`HTTP ${res.status}`);\n\n        // Write to Cache API\n        if (useCache) {\n            try {\n                // Clone response + headers\n                const clone = res.clone(),\n                    headers = new Headers(clone.headers);\n\n                // Set cache expiration header\n                headers.set(faH, Date.now().toString());\n\n                // Write to cache\n                await _cache.put(\n                    source,\n                    new Response(clone.body, {\n                        status: clone.status,\n                        statusText: clone.statusText,\n                        headers\n                    })\n                );\n            } catch { /* Ignore cache write errors */ }\n\n            // If the browser supports ReadableStream and it's a large file, return the stream\n            if (res.body && typeof ReadableStream !== 'undefined')\n                return res.body.pipeThrough(new TextDecoderStream());\n        }\n\n        // Return HTML string\n        return res.text();\n    }\n\n    // Define a new component from a URL, ID, or Template element\n    static define(tagName, source, config = {}) {\n        // Merge defaults, global config, and instance config\n        const settings = {\n            attributes: {},\n            loading: 'eager',\n            hooks: {\n                beforeFetch: (opts) => opts,\n                afterFetch: (data) => data,\n            },\n            ...AlpineComponentLoader.globalConfig,\n            ...config,\n            externalCss: [\n                ...(AlpineComponentLoader.globalConfig.externalCss || []),\n                ...(config.externalCss || [])\n            ],\n            externalScripts: [\n                ...(AlpineComponentLoader.globalConfig.externalScripts || []),\n                ...(config.externalScripts || [])\n            ],\n            sharedStyleSheets: [\n                ...(AlpineComponentLoader.globalConfig.sharedStyleSheets || []),\n                ...(config.sharedStyleSheets || [])\n            ],\n            errorCss: {\n                ...{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '0.5rem',\n                    padding: '1rem',\n                    border: '1px solid #fca5a5',\n                    backgroundColor: '#fee2e2',\n                    color: '#991b1b',\n                    borderRadius: '6px',\n                    fontFamily: 'sans-serif',\n                    fontSize: '0.9rem'\n                },\n                ...(AlpineComponentLoader.globalConfig.errorCss || {}),\n                ...(config.errorCss || {})\n            },\n            forwardEvents: [\n                ...(AlpineComponentLoader.globalConfig.forwardEvents || []),\n                ...(config.forwardEvents || [])\n            ],\n            fallback: config.fallback || null,\n            persist: config.persist || false,\n            persistKey: config.persistKey || null,\n            persistDebounce: config.persistDebounce || 250,\n            bindStore: config.bindStore || null,\n            dataSrc: config.dataSrc || null,\n            dataFetchParams: config.dataFetchParams || AlpineComponentLoader.globalConfig.dataFetchParams || null,\n            dataFetchKeys: config.dataFetchKeys || AlpineComponentLoader.globalConfig.dataFetchKeys || null,\n            dataFetchPoll: config.dataFetchPoll || AlpineComponentLoader.globalConfig.dataFetchPoll || null,\n            dataFetchTimeout: config.dataFetchTimeout || AlpineComponentLoader.globalConfig.dataFetchTimeout || 30000,\n            dataFetchOptions: config.dataFetchOptions || {},\n        };\n\n        // Track observed attributes internally\n        const observedAttrs = [\n            ...new Set([\n                ...Object.keys(settings.attributes),\n                'bind-store',\n                'data-src',\n                'data-fetch-params',\n                'data-fetch-keys',\n                'data-fetch-poll',\n                'data-fetch-timeout',\n            ]),\n        ];\n\n        // Prepend base path if source is a URL string\n        let contentSource = source;\n        if (typeof source === 'string' && !source.startsWith('#') && settings.basePath)\n            contentSource = settings.basePath + source;\n\n        // Register in internal registry to enable prefetching\n        AlpineComponentLoader._registry.set(tagName, { source: contentSource, settings });\n\n        // Return helpers to be assigned to $el.$props\n        const helpers = (_this) => ({\n            $emit: (name, detail) => _this.dispatchEvent(new CustomEvent(name, {\n                bubbles: true,\n                composed: true,\n                detail\n            })),\n            $reload: () => _this.reload(),\n        });\n\n        // Create component class\n        class AlpineExternalComponent extends HTMLElement {\n            constructor() {\n                super();\n\n                // Initialize props\n                let _$props = {\n                    $data: null,\n                    $loading: false,\n                    $error: null,\n                    $lastUpdated: Date.now(),\n                    ...helpers(this),\n                    ...settings.attributes || {}\n                };\n\n                // Initialize state and attributes\n                this._initialized = false;\n                this._loading = false;\n                this._disconnectTimeout = null;\n                this._fetchAbortController = null;\n                this.$props = window.Alpine ? window.Alpine.reactive(_$props) : _$props;\n                this._root = settings.shadow ? this.attachShadow({ mode: 'open' }) : this;\n                this._observer = null;\n                this._scopeId = `scope-${Math.random().toString(36).slice(2, 9)}`;\n                this._slotObserver = null;\n                this._originalLightDom = document.createDocumentFragment();\n                this._pollTimer = null;\n            }\n\n            // Define observed attributes\n            static get observedAttributes() {\n                return observedAttrs;\n            }\n\n            // Reactively update props when attributes change\n            attributeChangedCallback(name, oldVal, newVal) {\n                if (oldVal === newVal)\n                    return;\n\n                // Watch data-src and renamed fetch attributes\n                if (['data-src', 'data-fetch-params', 'data-fetch-keys', 'data-fetch-timeout'].includes(name)) {\n                    if (this._initialized)\n                        this._fetchData(this.getAttribute('data-src') || settings.dataSrc);\n                } else if (name === 'data-poll')\n                    this._startPolling(); // Restart polling with new interval\n                else\n                    this._updateProp(name, newVal);\n\n                // Emit updated event\n                if (this._initialized) {\n                    this._triggerHook('updated', { name, oldVal, newVal });\n                }\n            }\n\n            // Initialize on insertion\n            connectedCallback() {\n                this.setAttribute('data-acl-component', this.tagName);\n\n                // If we are just moving nodes, the disconnect timer is still running\n                // We clear it so the component stays alive\n                if (this._disconnectTimeout) {\n                    clearTimeout(this._disconnectTimeout);\n                    this._disconnectTimeout = null;\n                    return; // It was just a move, do nothing.\n                }\n\n                // If kept-alive and already initialized, just reactivate\n                if (this._initialized) {\n                    this._triggerHook('activated');\n                    return;\n                }\n\n                // Guard against parallel loading or already initialized states\n                if (this._loading)\n                    return;\n\n                // Lock loading state\n                this._loading = true;\n\n                // Sync attributes immediately for eager loading\n                this._syncAllAttributes();\n\n                // Check loading mode and load\n                const loadMode = this.getAttribute('loading') || settings.loading;\n                if (loadMode === 'lazy')\n                    this._initLazyObserver();\n                else if (loadMode === 'idle')\n                    this._initIdleLoader();\n                else\n                    this._load();\n\n                // Initialize data polling if configured\n                this._startPolling();\n            }\n\n            // Cleanup memory on removal\n            disconnectedCallback() {\n                // Stop polling\n                this._stopPolling();\n\n                // Stop observing slots\n                if (this._slotObserver) {\n                    this._slotObserver.disconnect();\n                    this._slotObserver = null;\n                }\n\n                // If flagged with keep-alive, skip destruction\n                if (this._isKeptAlive || this.hasAttribute('keep-alive')) {\n                    this._triggerHook('deactivated');\n                    return;\n                }\n\n                // Don't destroy immediately; give moves/rewrites time to reattach\n                this._disconnectTimeout = setTimeout(() => {\n                    // If we got re-attached after a slower move, abort cleanup\n                    if (this.isConnected) {\n                        this._disconnectTimeout = null;\n                        return;\n                    }\n\n                    // Emit unmounted\n                    this._triggerHook('unmounted');\n\n                    // Cancel any pending fetches\n                    if (this._fetchAbortController)\n                        this._fetchAbortController.abort();\n                    if (this._observer)\n                        this._observer.disconnect();\n                    if (this._root && window.Alpine && this._initialized)\n                        window.Alpine.destroyTree(this._root);\n\n                    // Reset state so the component can revive if re-attached\n                    this._initialized = false;\n                    this._loading = false;\n                    this._disconnectTimeout = null;\n                }, 250);\n            }\n\n            // Initiate the recursive polling timeout\n            _startPolling() {\n                this._stopPolling();\n                const interval = parseInt(this.getAttribute('data-fetch-poll') || settings.dataFetchPoll);\n                if (isNaN(interval) || interval <= 0)\n                    return;\n\n                // Start the timer\n                this._pollTimer = setTimeout(async () => {\n                    if (!this.isConnected)\n                        return;\n\n                    // Fetch data again\n                    const src = this.getAttribute('data-src') || settings.dataSrc;\n                    if (src && this._initialized && !this.$props.$loading)\n                        await this._fetchData(src, true);\n\n                    // Schedule next tick\n                    this._startPolling();\n                }, interval);\n            }\n\n            // Clear the active polling timeout\n            _stopPolling() {\n                if (this._pollTimer) {\n                    clearTimeout(this._pollTimer);\n                    this._pollTimer = null;\n                }\n            }\n\n            // intersectionObserver for lazy loading\n            _initLazyObserver() {\n                const placeholder = document.createElement('div');\n                placeholder.style.minHeight = '1px';\n                this._root.appendChild(placeholder);\n                this._observer = new IntersectionObserver((entries) => {\n                    if (entries[0].isIntersecting) {\n                        this._load();\n                        this._observer.disconnect();\n                        this._observer = null; // Kill the observer reference\n                    }\n                }, { rootMargin: '100px' });\n                this._observer.observe(this);\n            }\n\n            // Idle loading strategy\n            _initIdleLoader() {\n                if ('requestIdleCallback' in window) {\n                    requestIdleCallback(() => this._load(), { timeout: 2000 });\n                } else {\n                    setTimeout(() => this._load(), 200);\n                }\n            }\n\n            // Initialize MutationObserver for dynamic Light DOM slots\n            _initSlotObserver() {\n                if (this._slotObserver)\n                    return;\n\n                this._slotObserver = new MutationObserver((mutations) => mutations.forEach(mutation => {\n                    mutation.addedNodes.forEach(node => {\n                        // Only handle Elements and Text nodes\n                        if (node.nodeType !== Node.ELEMENT_NODE && node.nodeType !== Node.TEXT_NODE)\n                            return;\n\n                        // Ignore the slot containers themselves if they trigger an add\n                        if (node.nodeType === Node.ELEMENT_NODE && node.hasAttribute('data-acl-slot'))\n                            return;\n\n                        // Determine target slot name + find the internal slot container\n                        const slotName = (node.nodeType === Node.ELEMENT_NODE ? node.getAttribute('slot') : null) || 'default',\n                            container = this._root.querySelector(`div[data-acl-slot=\"${slotName}\"]`);\n\n                        // Move the node into the container\n                        if (container)\n                            container.appendChild(node);\n                    });\n                }));\n\n                // Only observe direct children additions\n                this._slotObserver.observe(this, { childList: true });\n            }\n\n            // Allow the component to be reloaded\n            async reload() {\n                if (this._loading)\n                    return;\n                console.log(`[ACL] Reloading <${tagName}>...`);\n\n                // Clear data cache for this specific endpoint\n                const currentDataSrc = this.getAttribute('data-src') || settings.dataSrc;\n                if (currentDataSrc)\n                    dataFetchCache.delete(currentDataSrc);\n\n                // Clear caches specific to this component's source\n                if (settings.cacheTemplates) {\n                    const cache = await caches.open(settings._templateCacheKey);\n                    await cache.delete(contentSource);\n                }\n\n                // Reset state\n                this._initialized = false;\n                this.$props.$loading = true;\n                this.$props.$error = null;\n                this.$props.$data = null;\n\n                // Re-trigger load\n                await this._load();\n            }\n\n            // Main load sequence\n            async _load() {\n                const startMark = performance.now();\n                try {\n                    // Lock loading state\n                    if (this._initialized)\n                        return;\n\n                    // Emit beforeMount\n                    this._triggerHook('beforeMount');\n\n                    // Load external dependencies, get content, and data if needed\n                    const promises = [\n                        (settings.externalCss.length || settings.externalScripts.length) ? this._loadExternalDependencies() : Promise.resolve(),\n                        this._resolveContent(contentSource),\n                        (settings.dataSrc || this.getAttribute('data-src')) ? this._fetchData(this.getAttribute('data-src') || settings.dataSrc) : Promise.resolve(),\n                    ];\n\n                    // Get content from the resolved source\n                    const content = (await Promise.all(promises))[1];\n\n                    // Capture existing children for slotting if using Light DOM\n                    let lightSlots = null;\n                    if (!settings.shadow)\n                        lightSlots = this._captureLightSlots();\n\n                    // Strict clear of root element\n                    this._root.replaceChildren();\n\n                    // Inject CSS Links into Shadow (Apply Styles locally)\n                    if (settings.shadow && settings.externalCss.length) {\n                        settings.externalCss.forEach(url => {\n                            const link = document.createElement('link');\n                            link.rel = 'stylesheet';\n                            link.href = url;\n                            this._root.appendChild(link);\n                        });\n                    }\n\n                    // Render content safely\n                    await this._renderSafe(content, lightSlots);\n\n                    // Setup event bubbling for Shadow DOM\n                    if (settings.shadow && settings.forwardEvents.length > 0)\n                        this._setupEventForwarding();\n\n                    // Start observing Light DOM for dynamic updates\n                    if (!settings.shadow)\n                        this._initSlotObserver();\n\n                    // Initialize Alpine\n                    await this._initAlpine();\n\n                    // Stop timer and store metrics\n                    this._perf = { duration: performance.now() - startMark };\n\n                    // Mark success and unlock\n                    this._initialized = true;\n                    this._loading = false;\n\n                    // Dispatch 'mount' event\n                    this._dispatch('mount');\n                    this._triggerHook('mounted');\n\n                    //Dispatch 'loaded' event\n                    this._dispatch('loaded');\n                } catch (err) {\n                    console.error(`[ACL] <${tagName}>`, err);\n                    this._loading = false; // Unlock on error so we can retry\n                    const fallbackSource = this.getAttribute('fallback') || settings.fallback;\n                    if (fallbackSource) {\n                        try {\n                            // Clear failed state\n                            this._root.replaceChildren();\n\n                            // Render fallback; pass null for slots as fallback usually doesn't slot user content\n                            await this._renderSafe(await this._resolveContent(fallbackSource), null);\n\n                            // Init Alpine (so fallback can be interactive)\n                            await this._initAlpine();\n\n                            // Stop timer and store metrics\n                            this._perf = { duration: performance.now() - startMark };\n\n                            // Mark success and unlock\n                            this._initialized = true;\n\n                            // Dispatch 'loaded' event\n                            this._dispatch('loaded');\n\n                            // Stop here, do not render default error\n                            return;\n                        } catch (fallbackErr) {\n                            console.error(`[ACL] <${tagName}> Fallback Failed:`, fallbackErr);\n                            // If fallback fails, show original error (or combined)\n                            this._renderError(`Load Failed: ${err.message}. (Fallback also failed)`);\n                        }\n                    } else {\n                        // Standard Error Display\n                        this._renderError(err.message);\n                    }\n                }\n            }\n\n            // Handle data fetching for APIs with caching, placeholders, and parameters\n            async _fetchData(url, skipCache = false) {\n                if (!url)\n                    return;\n\n                // Abort any pending component request and init new controller\n                if (this._fetchAbortController)\n                    this._fetchAbortController.abort();\n                this._fetchAbortController = new AbortController();\n                const signal = this._fetchAbortController.signal;\n\n                // Initialize reactive states for loading and error resets\n                this.$props.$loading = true;\n                this.$props.$error = null;\n                this.$props.$data = null;\n\n                // Enforce request timeout via AbortController cancellation\n                const timeoutId = setTimeout(() => this._fetchAbortController.abort('Timeout'), settings.dataFetchTimeout);\n\n                try {\n                    // Helper to resolve attributes as JSON, Expressions, or Functions (Sync/Async)\n                    const resolveValue = async (attrName, configVal) => {\n                        let result = {};\n                        const attrVal = this.getAttribute(attrName),\n                            context = {\n                                el: this,\n                                $el: this,\n                                props: this.$props,\n                                $props: this.$props,\n                                root: this._root,\n                                $root: this._root,\n                            };\n                        if (attrVal) {\n                            const trimmed = attrVal.trim();\n                            try {\n                                // Attempt standard JSON parsing first\n                                if (trimmed.startsWith('{') || trimmed.startsWith('['))\n                                    result = JSON.parse(trimmed.replace(/'/g, '\"'));\n                                else throw new Error();\n                            } catch {\n                                try {\n                                    // Evaluate as JS: supports arrow functions and dynamic expressions\n                                    // We inject $props and $el into the function scope for convenience\n                                    const evaled = (new Function('$props', '$el', `return (${trimmed})`))(this.$props, this);\n                                    result = typeof evaled === 'function' ? await evaled.call(this, context) : evaled;\n                                } catch (e) {\n                                    console.warn(`[ACL] Invalid value in ${attrName} for <${tagName}>`, e);\n                                }\n                            }\n                        }\n\n                        // Merge with JS-based configuration (if provided)\n                        if (configVal) {\n                            result = {\n                                ...result,\n                                ...(\n                                    (\n                                        typeof configVal === 'function'\n                                            ? await configVal.call(this, context)\n                                            : configVal\n                                    ) || {})\n                            };\n                        }\n\n                        return result;\n                    };\n\n                    // Resolve placeholders and query parameters from both HTML and JS config\n                    const keys = await resolveValue('data-fetch-keys', settings.dataFetchKeys),\n                        params = await resolveValue('data-fetch-params', settings.dataFetchParams);\n\n                    // Perform URL placeholder replacement (e.g., :userId -> 123)\n                    let resolvedUrl = url;\n                    Object.entries(keys).forEach(([k, v]) => resolvedUrl = resolvedUrl.replace(`:${k}`, toUrlValue(v)));\n\n                    // Build final URL string with appended query parameters\n                    let finalUrl = new URL(resolvedUrl, window.location.origin);\n                    if (Object.keys(params).length > 0)\n                        finalUrl.search = toSearchParamsDeep(params).toString();\n\n                    // Convert to string for caching\n                    finalUrl = finalUrl.toString();\n\n                    // Bypass shared cache if requested\n                    if (skipCache)\n                        dataFetchCache.delete(finalUrl);\n\n                    // Shared cache management (Deduplicate identical requests)\n                    if (!dataFetchCache.has(finalUrl)) {\n                        const fetchTask = (async () => {\n                            let options = {\n                                method: 'GET',\n                                headers: { 'Accept': 'application/json' },\n                                ...AlpineComponentLoader.globalConfig?.dataFetchOptions || {},\n                                ...settings?.dataFetchOptions || {}\n                            };\n\n                            // Apply beforeFetch hook for global or local request customization\n                            if (typeof settings?.hooks?.beforeFetch === 'function') {\n                                try {\n                                    const modified = await settings.hooks.beforeFetch(options);\n                                    if (modified && typeof modified === 'object')\n                                        options = modified;\n                                } catch (e) {\n                                    console.warn(`[ACL] beforeFetch hook error for <${tagName}>`, e);\n                                }\n                            }\n\n                            // Fetch and validate response status and content type\n                            const res = await fetch(finalUrl, options);\n                            if (!res.ok)\n                                throw new Error(`API Error: ${res.status}`);\n\n                            // Validate content type header as JSON\n                            const contentType = res.headers.get(\"content-type\");\n                            if (!contentType?.includes(\"application/json\"))\n                                throw new Error(\"Invalid JSON response\");\n\n                            // Parse JSON response\n                            return await res.json();\n                        })();\n\n                        // Store pending promise in cache and prune on failure\n                        dataFetchCache.set(finalUrl, fetchTask);\n                        fetchTask.catch(() => dataFetchCache.delete(finalUrl));\n                    }\n\n                    // Race the shared network task against local abort/timeout logic\n                    const json = await Promise.race([\n                        dataFetchCache.get(finalUrl),\n                        new Promise((_, reject) => signal.addEventListener('abort', () => reject(new Error('Aborted')), { once: true }))\n                    ]);\n\n                    // Transform received data via afterFetch hook\n                    let processedData = json;\n                    if (typeof settings?.hooks?.afterFetch === 'function') {\n                        try {\n                            let modified = await settings.hooks.afterFetch(json);\n                            if (modified && typeof modified === 'object')\n                                processedData = modified;\n                        } catch (e) {\n                            console.warn(`[ACL] afterFetch hook error for <${tagName}>`, e);\n                        }\n                    }\n\n                    // Finalize component data update if not locally aborted\n                    if (!signal.aborted)\n                        this.$props.$data = processedData;\n\n                } catch (e) {\n                    // Handle errors or timeout cancellations for the specific instance\n                    if (signal.aborted) {\n                        if (signal.reason === 'Timeout') {\n                            this.$props.$error = `Request timed out after ${settings.fetchTimeout}ms`;\n                            this.$props.$data = null;\n                        }\n                        return;\n                    }\n                    console.error(`[ACL] Fetch failed for ${url}`, e);\n                    this.$props.$error = e.message;\n                    this.$props.$data = null;\n                } finally {\n                    // Cleanup timers and unlock component loading states\n                    clearTimeout(timeoutId);\n                    if (!signal.aborted || signal.reason === 'Timeout') {\n                        this.$props.$loading = false;\n                        if (this._fetchAbortController?.signal === signal)\n                            this._fetchAbortController = null;\n                    }\n                }\n            }\n\n            // Helper to execute hooks\n            _triggerHook(hookName, detail = {}) {\n                if (settings.hooks && typeof settings.hooks[hookName] === 'function') {\n                    settings.hooks[hookName].call(this, {\n                        el: this,\n                        root: this._root,\n                        props: this.$props,\n                        ...detail\n                    });\n                }\n            }\n\n            // Load external CSS/JS dependencies\n            async _loadExternalDependencies() {\n                const promises = [];\n\n                // CSS: Always inject into global head\n                // This ensures @font-face and @keyframes are registered globally\n                settings.externalCss.forEach(url => {\n                    // Check if link exists in head\n                    if (!document.querySelector(`link[href=\"${url}\"]`)) {\n                        const link = document.createElement('link');\n                        link.rel = 'stylesheet';\n                        link.href = url;\n                        document.head.appendChild(link);\n                    }\n                });\n\n                // Scripts: Only inject if not already loaded\n                // This ensures scripts are loaded in the correct order\n                settings.externalScripts.forEach(url => {\n                    if (!scriptLoadCache.has(url)) {\n                        const p = new Promise((resolve, reject) => {\n                            if (document.querySelector(`script[src=\"${url}\"]`)) {\n                                resolve();\n                                return;\n                            }\n                            const script = document.createElement('script');\n                            script.src = url;\n                            script.async = true;\n                            script.onload = () => resolve();\n                            script.onerror = () => reject(new Error(`Failed to load script: ${url}`));\n                            document.head.appendChild(script);\n                        });\n                        scriptLoadCache.set(url, p);\n                    }\n                    promises.push(scriptLoadCache.get(url));\n                });\n\n                // Wait for all promises\n                await Promise.all(promises);\n            }\n\n            // Manual slot polyfill for Light DOM\n            _captureLightSlots() {\n                // Recover slotted nodes if re-rendering (prevent loss)\n                if (this._initialized)\n                    this._root.querySelectorAll('[data-acl-slot]').forEach(container => {\n                        while (container.firstChild)\n                            this._originalLightDom.appendChild(container.firstChild);\n                    });\n\n                // Capture any new direct children (First load or dynamic additions)\n                while (this.firstChild)\n                    this._originalLightDom.appendChild(this.firstChild);\n\n                // We iterate the storage fragment to sort nodes into the slots map\n                // Note: The nodes physically exist in the fragment until moved by _renderSafe\n                return Array.from(this._originalLightDom.childNodes).reduce((slots, node) => {\n                    // Determine slot name\n                    const name = (\n                        node.nodeType === Node.ELEMENT_NODE && node.hasAttribute('slot')\n                    ) ? node.getAttribute('slot') : 'default';\n\n                    // Add node to slot\n                    return {\n                        ...slots,\n                        [name]: (slots[name] || []).concat(node)\n                    };\n                }, { default: [] });\n            }\n\n            // Render logic using DOM manipulation\n            async _renderSafe(content, lightSlots) {\n                let rootNode;\n\n                // Convert stream to string if needed\n                if (content instanceof ReadableStream) {\n                    const reader = content.getReader(),\n                        decoder = new TextDecoder(),\n                        accumulator = [];\n                    while (true) {\n                        const { done, value } = await reader.read();\n                        if (done)\n                            break;\n                        accumulator.push(typeof value === 'string' ? value : decoder.decode(value, { stream: true }));\n                    }\n                    content = accumulator.join('') + decoder.decode();\n\n                    console.log('[ACL] Stream content loaded as string.');\n                }\n\n                // Parse string to DOM if needed, otherwise clone fragment\n                if (typeof content === 'string') {\n                    // Parse HTML to DOM\n                    const doc = (new DOMParser()).parseFromString(content, 'text/html');\n\n                    // Create document fragment to hold elements\n                    rootNode = document.createDocumentFragment();\n\n                    // Move elements from head/body (styles, title, meta and actual markup)\n                    [\n                        ...Array.from(doc.head.childNodes),\n                        ...Array.from(doc.body.childNodes),\n                    ].forEach(node => rootNode.appendChild(node));\n                } else\n                    rootNode = content.cloneNode(true);\n\n                // Process styles (constructible, scoping, or stripping)\n                if (!settings.stripStyles) {\n                    const styles = Array.from(rootNode.querySelectorAll('style'));\n\n                    // Constructible stylesheets (Shadow DOM only)\n                    if (settings.shadow && settings.useConstructibleStyles && document.adoptedStyleSheets) {\n                        const combinedCss = styles.map(s => s.textContent).join('\\n');\n                        let sheet = null;\n\n                        if (combinedCss.trim().length > 0) {\n                            if (styleSheetCache.has(combinedCss))\n                                sheet = styleSheetCache.get(combinedCss);\n                            else {\n                                sheet = new CSSStyleSheet();\n                                sheet.replaceSync(combinedCss);\n                                styleSheetCache.set(combinedCss, sheet);\n                            }\n                        }\n\n                        // Apply shared + internal styles\n                        this._root.adoptedStyleSheets = [\n                            ...(settings.sharedStyleSheets || []),\n                            ...(sheet ? [sheet] : [])\n                        ];\n\n                        // Remove style tags since we moved them to adoptedStyleSheets\n                        styles.forEach(el => el.remove());\n                    } else {\n                        // Fallback: Standard tag injection + scoping\n                        styles.forEach(style => {\n                            if (!settings.shadow) {\n                                // Native @scope support\n                                if ('CSSScopeRule' in window) {\n                                    style.textContent = `@scope { ${style.textContent.replace(/:host/g, ':scope')} }`;\n                                } else {\n                                    this.setAttribute('data-scope', this._scopeId);\n\n                                    // Handles :host(.active) -> tagName[data-scope].active\n                                    // Handles :host -> tagName[data-scope]\n                                    const scopeSelector = `${tagName}[data-scope=\"${this._scopeId}\"]`;\n                                    if (style.textContent.includes(':host')) {\n                                        style.textContent = style.textContent\n                                            .replace(/:host\\s*\\(([^)]+)\\)/g, `${scopeSelector}$1`) // Handle :host(...)\n                                            .replace(/:host/g, scopeSelector);                     // Handle :host\n                                    }\n                                }\n                            }\n                        });\n                    }\n                } else {\n                    rootNode.querySelectorAll('style').forEach(el => el.remove());\n                }\n\n                // Process scripts (security check and re-creation)\n                const scripts = [];\n                if (settings.executeScripts) {\n                    rootNode.querySelectorAll('script').forEach(oldScript => {\n                        const newScript = document.createElement('script');\n                        Array.from(oldScript.attributes).forEach(attr =>\n                            newScript.setAttribute(attr.name, attr.value)\n                        );\n                        newScript.textContent = oldScript.textContent;\n                        scripts.push(newScript);\n                        oldScript.remove();\n                    });\n                } else {\n                    rootNode.querySelectorAll('script').forEach(el => el.remove());\n                }\n\n                // Inject Light DOM slots if needed\n                if (!settings.shadow) {\n                    // Instead of replacing the slot entirely, we replace it with a persistent container\n                    // This allows us to append new nodes to it later via the MutationObserver\n                    rootNode.querySelectorAll('slot').forEach(slotEl => {\n                        const name = slotEl.getAttribute('name') || 'default';\n\n                        // Create a transparent wrapper acting as the slot\n                        const anchor = document.createElement('div');\n                        anchor.style.display = 'contents';\n                        anchor.setAttribute('data-acl-slot', name);\n\n                        // Insert pre-captured nodes (initial render)\n                        const nodesToInsert = lightSlots ? lightSlots[name] : null;\n                        if (nodesToInsert && nodesToInsert.length > 0) {\n                            nodesToInsert.forEach(node => anchor.appendChild(node));\n                        }\n                        // Fallback content (if no nodes provided)\n                        else if (slotEl.childNodes.length > 0) {\n                            while (slotEl.firstChild)\n                                anchor.appendChild(slotEl.firstChild);\n                        }\n\n                        // Replace the <slot> tag with our anchor\n                        slotEl.replaceWith(anchor);\n                    });\n                }\n\n                // Move nodes to component root\n                while (rootNode.firstChild) {\n                    const node = rootNode.firstChild;\n\n                    // Attach props directly to element\n                    if (node.nodeType === 1)\n                        node.$props = this.$props;\n\n                    // Append to root\n                    this._root.appendChild(node);\n                }\n\n                // Append scripts to trigger execution\n                scripts.forEach(s => this._root.appendChild(s));\n            }\n\n            // Forward specific events out of Shadow DOM\n            _setupEventForwarding() {\n                settings.forwardEvents.forEach(eventName => {\n                    this._root.addEventListener(eventName, (e) => {\n                        this.dispatchEvent(new CustomEvent(eventName, {\n                            bubbles: true,\n                            composed: true,\n                            detail: e.detail\n                        }));\n                    });\n                });\n            }\n\n            // Advanced prop validation and type casting\n            _updateProp(name, value) {\n                // Skip data-src, it's handled separately\n                if (name === 'data-src')\n                    return;\n\n                // Get config\n                const configDef = settings.attributes[name];\n\n                // Normalization: handle { type: String } vs just String\n                const type = (configDef && configDef.type) ? configDef.type : configDef,\n                    required = (configDef && configDef.required) === true,\n                    validator = (configDef && configDef.validator) ? configDef.validator : null,\n                    defaultValue = (configDef && configDef.hasOwnProperty('default')) ? configDef.default : undefined,\n                    options = (configDef && configDef.options) ? configDef.options : null,\n                    schema = (configDef && configDef.schema) ? configDef.schema : null;\n\n                // Handle null/undefined values\n                if (value === null || value === undefined) {\n                    if (defaultValue !== undefined) {\n                        this.$props[name] = defaultValue;\n                        return;\n                    }\n                    if (required)\n                        console.warn(`[ACL] Missing required prop \"${name}\" on <${tagName}>`);\n\n                    this._applyTypeDefault(name, type);\n                    return;\n                }\n\n                // Type Casting\n                let parsedValue;\n                if (type === Boolean) {\n                    parsedValue = (value !== null && value !== 'false');\n                } else if (type === Number) {\n                    const num = Number(value);\n                    parsedValue = isNaN(num) ? 0 : num;\n                } else if (type === Object || type === Array) {\n                    try {\n                        if (!value) parsedValue = (type === Array) ? [] : {};\n                        else parsedValue = JSON.parse(value.replace(/'/g, '\"'));\n                    } catch (e) {\n                        console.warn(`[ACL] Attribute \"${name}\" is invalid JSON:`, value);\n                        parsedValue = (type === Array) ? [] : {};\n                    }\n                } else {\n                    parsedValue = value;\n                }\n\n                // Validate against 'enums' (allowed values)\n                if (options && Array.isArray(options) && !options.includes(parsedValue)) {\n                    console.warn(`[ACL] Value \"${parsedValue}\" is not a valid option for prop \"${name}\" on <${tagName}>. Allowed:`, options);\n                    if (defaultValue !== undefined)\n                        this.$props[name] = defaultValue;\n                    else if (this.$props[name] === undefined)\n                        this._applyTypeDefault(name, type);\n                    return;\n                }\n\n                // Validate with a JSON Schema\n                if (schema && type === Object && typeof parsedValue === 'object' && parsedValue !== null) {\n                    if (Object.entries(schema).some(([k, t]) => {\n                        const val = parsedValue[k];\n                        if (val === undefined)\n                            return true;\n                        if (t === String)\n                            return typeof val !== 'string';\n                        if (t === Number)\n                            return typeof val !== 'number';\n                        if (t === Boolean)\n                            return typeof val !== 'boolean';\n                        if (t === Array)\n                            return !Array.isArray(val);\n                        if (t === Object)\n                            return typeof val !== 'object' || Array.isArray(val) || val === null;\n                        return false;\n                    })) {\n                        console.warn(`[ACL] Schema validation failed for prop \"${name}\" on <${tagName}>.`);\n                        if (defaultValue !== undefined)\n                            this.$props[name] = defaultValue;\n                        else if (this.$props[name] === undefined)\n                            this._applyTypeDefault(name, type);\n                        return;\n                    }\n                }\n\n                // Validation: Custom Validator\n                if (validator && typeof validator === 'function') {\n                    if (!validator(parsedValue)) {\n                        console.warn(`[ACL] Validation failed for prop \"${name}\" on <${tagName}>. Value:`, parsedValue);\n                        // If we have a default, use it\n                        if (defaultValue !== undefined)\n                            this.$props[name] = defaultValue;\n                        // If prop is currently undefined (initial load), set a safe type default\n                        else if (this.$props[name] === undefined)\n                            this._applyTypeDefault(name, type);\n                        // If prop already had a value (update), do nothing (keep old valid value)\n                        return;\n                    }\n                }\n\n                this.$props[name] = parsedValue;\n            }\n\n            // Helper for type safety\n            _applyTypeDefault(name, type) {\n                if (type === Number)\n                    this.$props[name] = 0;\n                else if (type === Boolean)\n                    this.$props[name] = false;\n                else if (type === Array)\n                    this.$props[name] = [];\n                else if (type === Object)\n                    this.$props[name] = {};\n                else this.$props[name] = '';\n            }\n\n            // Reactively update props when attributes change\n            _syncAllAttributes() {\n                observedAttrs.forEach(name => this._updateProp(name, this.getAttribute(name)));\n            }\n\n            // Initialize persistence strategy with helpers\n            _initPersistence() {\n                const mode = this.getAttribute('persist') || settings.persist;\n                if (!mode)\n                    return;\n\n                // Choose storage (default to sessionStorage if not specified), generate key, and debounce config\n                const storage = (mode === 'local') ? localStorage : sessionStorage,\n                    key = this.getAttribute('persist-key') || settings.persistKey ||\n                        `acl:${this.localName}:${this.id ? ':' + this.id : 'no-id'}`,\n                    debounceMs = parseInt(this.getAttribute('persist-debounce') || settings.persistDebounce || '250', 10);\n\n                // Debounce timer for persistence\n                let _timer = null;\n\n                // Create a clean snapshot\n                const getSnapshot = () => Object.fromEntries(\n                    Object.entries(this.$props)\n                        .filter(([k, v]) => !k.startsWith('$') && typeof v !== 'function')\n                );\n\n                // Perform immediate save\n                const saveNow = (value) => {\n                    if (_timer)\n                        clearTimeout(_timer);\n                    _timer = null;\n                    storage.setItem(key, JSON.stringify(value || getSnapshot()));\n                };\n\n                // Attach persistence helpers\n                this.$props.$persistence = {\n                    $key: key,\n                    $save: (value) => {\n                        if (debounceMs > 0) {\n                            if (_timer)\n                                clearTimeout(_timer);\n                            _timer = setTimeout(() => saveNow(value), debounceMs);\n                        } else {\n                            saveNow(value);\n                        }\n                    },\n                    $clear: () => {\n                        if (_timer)\n                            clearTimeout(_timer);\n                        _timer = null;\n                        storage.removeItem(key);\n                    },\n                    $get: (k = null, fallback = null) => {\n                        try {\n                            let stored = JSON.parse(storage.getItem(key));\n                            return (k ? stored[k] : stored) || fallback;\n                        } catch (e) {\n                            return fallback;\n                        }\n                    },\n                    $flush: () => {\n                        if (_timer)\n                            saveNow();\n                    }\n                };\n\n                // Restore state on load\n                try {\n                    const stored = this.$props.$persistence.$get();\n                    if (stored && typeof stored === 'object')\n                        for (const k in this.$props)\n                            if (Object.prototype.hasOwnProperty.call(stored, k))\n                                this.$props[k] = stored[k];\n                } catch (e) {\n                    console.warn(`[ACL] Restore failed for ${key}`, e);\n                }\n\n                // Start saving on Alpine updates\n                Alpine.effect(() => this.$props.$persistence.$save(getSnapshot()));\n\n                // Flush on page unload to prevent data loss\n                if (debounceMs > 0)\n                    window.addEventListener('beforeunload', () => this.$props.$persistence.$flush());\n            }\n\n            // Wait for Alpine.js to load\n            async _initAlpine() {\n                if (window.Alpine)\n                    return this._finishAlpineInit();\n\n                // Bind to alpine:init event + timeout if it is not fired\n                return new Promise((resolve, reject) => {\n                    document.addEventListener('alpine:init', () => {\n                        this._finishAlpineInit();\n                        resolve();\n                    }, { once: true });\n\n                    // Timeout\n                    setTimeout(() => {\n                        if (window.Alpine) {\n                            this._finishAlpineInit();\n                            resolve();\n                        }\n                        else\n                            reject(new Error(\"Alpine.js not found (Timeout)\"));\n                    }, 5000);\n                });\n            }\n\n            // Bridge props to Alpine store and init tree once Alpine is ready\n            _finishAlpineInit() {\n                // Bind Alpine store if provided\n                const storeName = this.getAttribute('bind-store') || settings.bindStore;\n                if (storeName) {\n                    let store = Alpine.store(storeName);\n                    if (store) {\n                        // Merge Alpine store with provided $props\n                        if (this.$props && typeof this.$props === 'object')\n                            Object.keys(this.$props)\n                                .filter(key => store[key] === undefined)\n                                .forEach(key => store[key] = this.$props[key]);\n\n                        // Set $props to Alpine store\n                        this.$props = store;\n                    } else {\n                        console.error(`[ACL] Store \"${storeName}\" not found. Falling back to local state.`);\n                        this.$props = window.Alpine.reactive(this.$props || {});\n                    }\n                } else {\n                    // Initialize Alpine Store\n                    this.$props = window.Alpine.reactive(this.$props || {});\n                }\n\n                // Initialize persistence\n                this._initPersistence();\n\n                // Track reactive updates for the debugger\n                // We manually touch all props *except* $lastUpdated to avoid an infinite loop\n                Alpine.effect(() => {\n                    if (this.$props) {\n                        Object.keys(this.$props).forEach(k => {\n                            if (k !== '$lastUpdated')\n                                void this.$props[k];\n                        });\n                        this.$props.$lastUpdated = Date.now();\n                    }\n                });\n\n                // Set an anonymous Alpine store for debugging\n                Alpine.store(`props_${tagName}_${Math.random().toString(36).slice(2)}`, this.$props);\n\n                // Pass the reactive reference to all children\n                // Any change to this.$props by children will now update the Store directly (and vice versa)\n                if (this._root && this._root.children)\n                    Array.from(this._root.children).forEach(node => {\n                        if (node.nodeType === 1)\n                            node.$props = this.$props;\n                    });\n\n                // We wrap in nextTick to ensure the DOM is settled before Alpine scans it\n                window.Alpine.nextTick(() => {\n                    if (this._root)\n                        window.Alpine.initTree(this._root);\n                });\n            }\n\n            // Render error message safely\n            _renderError(msg) {\n                const container = document.createElement('div');\n                container.style.cssText = toCssString(settings.errorCss);\n\n                const header = document.createElement('strong');\n                header.textContent = `Load Failed: <${tagName}>`;\n\n                const code = document.createElement('code');\n                code.textContent = msg;\n                code.style.display = 'block';\n                code.style.marginTop = '4px';\n                container.appendChild(header);\n                container.appendChild(code);\n\n                if (settings.shadow)\n                    this._root.replaceChildren(container);\n                else\n                    this._root.appendChild(container);\n            }\n\n            // Dispatch custom event\n            _dispatch(eventName) {\n                this.dispatchEvent(new CustomEvent(eventName, {\n                    bubbles: true,\n                    composed: true,\n                    detail: { props: this.$props }\n                }));\n            }\n\n            // Resolve URL string, ID selector, or Template object\n            async _resolveContent(source) {\n                return await AlpineComponentLoader.loadTemplate(source, settings);\n            }\n\n            // Helpers to deal with template caches within the component\n            // TODO: Implement as a an available Alpine directive/$props function\n            async _pruneCache() { return await AlpineComponentLoader.pruneCache(settings._templateCachePrefix, settings._templateCacheKey); }\n            async _clearCache() { return await AlpineComponentLoader.clearCache(settings._templateCacheKey); }\n        }\n\n        // Register custom element\n        customElements.define(tagName, AlpineExternalComponent);\n    }\n}\n\n// Declarative component proxy, replaces itself with the loaded component\nclass AlpineDeclarativeLoader extends HTMLElement {\n    async connectedCallback() {\n        const src = this.getAttribute('src') || this.getAttribute('url');\n        if (!src) {\n            console.error(`<${this.localName}>: missing \"src\" attribute`);\n            return;\n        }\n\n        // Determine Tag Name (Attribute > Filename)\n        let tagName = this.getAttribute('tag');\n        if (!tagName)\n            tagName = (src.split('/').pop()).split('.').shift(); // Strip extension\n\n        // Validate tag name; ensure it contains a hyphen\n        if (!tagName.includes('-')) {\n            console.error(`<${this.localName}>: Tag name \"${tagName}\" must contain a hyphen.`);\n            return;\n        }\n\n        // Parse Config from Attributes\n        const config = {\n            shadow: this.hasAttribute('shadow') ? (this.getAttribute('shadow') !== 'false') : AlpineComponentLoader.globalConfig.shadow,\n            loading: this.getAttribute('loading') || 'eager',\n            dataSrc: this.getAttribute('data-src') || null,\n            bindStore: this.getAttribute('bind-store') || null,\n            fallback: this.getAttribute('fallback') || null,\n            attributes: {} // Auto-inference of props\n        };\n\n        // Define the component (if not already defined)\n        if (!customElements.get(tagName)) {\n            // Heuristic: Check other attributes to guess Prop Types\n            for (const attr of this.attributes) {\n                if ([\n                    'src', 'url', 'tag', 'shadow', 'loading', 'class', 'style', 'id', 'bind-store', 'fallback',\n                    'data-src', 'data-fetch-keys', 'data-fetch-params', 'data-fetch-timeout', 'data-fetch-poll'\n                ].includes(attr.name))\n                    continue;\n\n                // If value looks like JSON Array/Object, treat as such\n                const val = attr.value.trim();\n\n                // Try to infer type\n                let inferredType = String;\n                if (val.startsWith('[') || val.startsWith('{')) inferredType = (val.startsWith('[')) ? Array : Object;\n                else if (val === 'true' || val === 'false' || val === '') inferredType = Boolean;\n                else if (!isNaN(Number(val))) inferredType = Number;\n\n                // Add to config\n                config.attributes[attr.name] = inferredType;\n            }\n\n            // Define the component\n            AlpineComponentLoader.define(tagName, src, config);\n        }\n\n        // Create the REAL element\n        const realElement = document.createElement(tagName);\n\n        // Forward Attributes (Props, Classes, IDs)\n        for (const attr of this.attributes) {\n            if (['src', 'url', 'tag', 'shadow'].includes(attr.name))\n                continue; // Don't forward loader-specific config\n            realElement.setAttribute(attr.name, attr.value);\n        }\n\n        // Move any children (slots) to the REAL element\n        while (this.firstChild)\n            realElement.appendChild(this.firstChild);\n\n        // Swap in the DOM\n        this.replaceWith(realElement);\n    }\n}\n\n// Dynamic component switcher\nclass AlpineDynamicLoader extends HTMLElement {\n    static get observedAttributes() {\n        return ['is'];\n    }\n\n    constructor() {\n        super();\n        this._cache = new Map();\n    }\n\n    attributeChangedCallback(name, oldVal, newVal) {\n        if (name === 'is' && newVal && newVal !== oldVal)\n            this._switch(newVal);\n    }\n\n    connectedCallback() {\n        this.setAttribute('data-acl-component', 'acl-dynamic');\n        if (!this.firstElementChild && this.getAttribute('is'))\n            this._switch(this.getAttribute('is'));\n    }\n\n    disconnectedCallback() {\n        // Cleanup cache to prevent memory leaks when loader is removed\n        this._cache.forEach(el => {\n            if (el._root && window.Alpine)\n                window.Alpine.destroyTree(el._root);\n        });\n        this._cache.clear();\n    }\n\n    // Switch to a new component with View Transitions support\n    async _switch(tag) {\n        if (!tag)\n            return;\n        tag = tag.toLowerCase();\n\n        const updateDOM = () => {\n            const keepAlive = this.hasAttribute('keep-alive'),\n                current = this.firstElementChild;\n\n            // Cache the current component if keep-alive is active\n            if (current && keepAlive) {\n                // Save scroll position before detaching\n                current._savedScroll = current.scrollTop;\n\n                // Mark as kept alive so disconnectedCallback doesn't destroy it\n                current._isKeptAlive = true;\n                this._cache.set(current.tagName.toLowerCase(), current);\n\n                // Detach\n                current.remove();\n\n                // Reset flag for future legitimate removals\n                current._isKeptAlive = false;\n            } else {\n                // Standard tear down\n                this.replaceChildren();\n\n                // If we turned off keep-alive, ensure we don't hold onto old refs\n                if (current && !keepAlive)\n                    this._cache.delete(current.tagName.toLowerCase());\n            }\n\n            // Restore or Create new component\n            let el;\n            if (keepAlive && this._cache.has(tag)) {\n                el = this._cache.get(tag);\n\n                // Restore scroll position\n                if (el._savedScroll)\n                    setTimeout(() => el.scrollTop = el._savedScroll, 0);\n            } else {\n                try {\n                    el = document.createElement(tag);\n                    // Forward attributes (excluding loader-specific ones)\n                    Array.from(this.attributes).forEach(attr => {\n                        if (!['is', 'keep-alive'].includes(attr.name))\n                            el.setAttribute(attr.name, attr.value);\n                    });\n                } catch (e) {\n                    console.error(`[ACL] Failed to create: <${tag}>`, e);\n                }\n            }\n\n            // Add to DOM\n            if (el)\n                this.appendChild(el);\n\n            // Return the new element\n            return el;\n        };\n\n        // Use native View Transitions if available for animated switching\n        if (document.startViewTransition) {\n            document.startViewTransition(() => updateDOM());\n        } else {\n            // Manual fallback transition logic (Fade out/in)\n            const current = this.firstElementChild;\n            if (current) {\n                current.style.transition = 'opacity 0.1s ease-out';\n                current.style.opacity = '0';\n                await new Promise(r => setTimeout(r, 100));\n            }\n\n            // Update DOM\n            const el = updateDOM();\n            if (el) {\n                el.style.opacity = '0';\n                el.style.transition = 'opacity 0.1s ease-in';\n                requestAnimationFrame(() => {\n                    el.style.opacity = '1';\n                    setTimeout(() => {\n                        el.style.transition = '';\n                        el.style.opacity = '';\n                    }, 100);\n                });\n            }\n        }\n    }\n}\n\n// Once DOM is ready, start loading components\ntry {\n    if (document.readyState === 'loading') {\n        window.addEventListener('DOMContentLoaded', AlpineComponentLoader.start, { once: true });\n    } else {\n        AlpineComponentLoader.start();\n    }\n} catch (e) {\n    console.warn(`[ACL] Failed to register components:`, e);\n}"]}